<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatHub Online</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; }
        #root { width: 100vw; height: 100vh; }
        .notification {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        video {
            object-fit: cover;
        }
        .pulse-sync {
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        .premium-badge {
            background: linear-gradient(45deg, #FFD700, #FFA500, #FFD700);
            background-size: 200% 200%;
            animation: shimmer 2s infinite;
        }
        @keyframes shimmer {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Lucide Icons (Ð´Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð½Ð¾Ð²Ñ‹Ðµ Ð¸ÐºÐ¾Ð½ÐºÐ¸ Ð´Ð»Ñ Ð¿Ñ€ÐµÐ¼Ð¸ÑƒÐ¼ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹)
        const MessageCircle = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M7.9 20A9 9 0 1 0 4 16.1L2 22Z"/></svg>;
        const Users = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>;
        const Plus = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M5 12h14"/><path d="M12 5v14"/></svg>;
        const Hash = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="4" x2="20" y1="9" y2="9"/><line x1="4" x2="20" y1="15" y2="15"/><line x1="10" x2="8" y1="3" y2="21"/><line x1="16" x2="14" y1="3" y2="21"/></svg>;
        const Volume2 = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/></svg>;
        const Mic = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" x2="12" y1="19" y2="22"/></svg>;
        const MicOff = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="2" x2="22" y1="2" y2="22"/><path d="M18.89 13.23A7.12 7.12 0 0 0 19 12v-2"/><path d="M5 10v2a7 7 0 0 0 12 5"/><path d="M15 9.34V5a3 3 0 0 0-5.68-1.33"/><path d="M9 9v3a3 3 0 0 0 5.12 2.12"/><line x1="12" x2="12" y1="19" y2="22"/></svg>;
        const Phone = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>;
        const PhoneOff = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"/><line x1="22" x2="2" y1="2" y2="22"/></svg>;
        const UserPlus = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><line x1="19" x2="19" y1="8" y2="14"/><line x1="22" x2="16" y1="11" y2="11"/></svg>;
        const Check = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 6 9 17l-5-5"/></svg>;
        const X = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>;
        const LogOut = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>;
        const Video = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m16 10 5-3v10l-5-3"/><rect width="12" height="12" x="2" y="6" rx="2"/></svg>;
        const VideoOff = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10.66 5H14a2 2 0 0 1 2 2v2.34l1 1L22 7v10"/><path d="m16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2l10 10Z"/><line x1="2" x2="22" y1="2" y2="22"/></svg>;
        const Monitor = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="20" height="14" x="2" y="3" rx="2"/><line x1="8" x2="16" y1="21" y2="21"/><line x1="12" x2="12" y1="17" y2="21"/></svg>;
        const MonitorOff = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 17H4a2 2 0 0 1-2-2V5c0-1.5 1-2 1-2"/><path d="M22 15V5a2 2 0 0 0-2-2H9"/><path d="M8 21h8"/><path d="M12 17v4"/><path d="m2 2 20 20"/></svg>;
        const Settings = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/></svg>;
        const Send = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m22 2-7 20-4-9-9-4Z"/><path d="M22 2 11 13"/></svg>;
        const Edit = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/><path d="M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z"/></svg>;
        const Trash2 = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>;
        const Copy = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"/><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"/></svg>;
        const Mail = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>;
        const Bell = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9"/><path d="M10.3 21a1.94 1.94 0 0 0 3.4 0"/></svg>;
        const User = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>;
        const Github = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"/></svg>;
        const Cloud = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z"/></svg>;
        const RefreshCw = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M8 16H3v5"/></svg>;
        const Crown = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z"/><path d="M5 21h14"/></svg>;
        const Star = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>;
        const Zap = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>;
        const Gift = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="8" width="18" height="4" rx="1"/><path d="M12 8v13"/><path d="M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7"/><path d="M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5"/></svg>;

        // Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð½Ð¾Ðµ Ñ…Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ðµ Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð¹ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹
        const storage = {
            // ... ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ ÐºÐ¾Ð´ Ñ…Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ð° Ð±ÐµÐ· Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹ ...
            gistId: null,
            token: null,
            isInitialized: false,
            lastSync: null,
            
            // Ð˜Ð½Ð¸Ñ†Ð¸Ð°Ð»Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¼ Ð¿Ð¾Ð¸ÑÐºÐ¾Ð¼ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ³Ð¾ gist
            init: async (token) => {
                storage.token = token;
                
                try {
                    // Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¸Ñ‰ÐµÐ¼ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¹ gist
                    const response = await fetch('https://api.github.com/gists', {
                        headers: {
                            'Authorization': `token ${token}`
                        }
                    });
                    
                    if (response.ok) {
                        const gists = await response.json();
                        // Ð˜Ñ‰ÐµÐ¼ gist Ñ Ð¾Ð¿Ð¸ÑÐ°Ð½Ð¸ÐµÐ¼ ChatHub
                        const chatHubGist = gists.find(gist => 
                            gist.description && gist.description.includes('ChatHub Online Database')
                        );
                        
                        if (chatHubGist) {
                            storage.gistId = chatHubGist.id;
                            localStorage.setItem('gistId', chatHubGist.id);
                            localStorage.setItem('githubToken', token);
                            storage.isInitialized = true;
                            storage.lastSync = Date.now();
                            return { success: true, isNew: false };
                        }
                    }
                    
                    // Ð•ÑÐ»Ð¸ Ð½Ðµ Ð½Ð°ÑˆÐ»Ð¸, ÑÐ¾Ð·Ð´Ð°ÐµÐ¼ Ð½Ð¾Ð²Ñ‹Ð¹
                    const createResponse = await fetch('https://api.github.com/gists', {
                        method: 'POST',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            description: 'ChatHub Online Database',
                            public: false,
                            files: {
                                'data.json': {
                                    content: JSON.stringify({
                                        users: [],
                                        servers: [],
                                        messages: {},
                                        dmMessages: {},
                                        activeVoiceChannels: {},
                                        profiles: {},
                                        subscriptions: {} // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ñ…Ñ€Ð°Ð½ÐµÐ½Ð¸Ðµ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ¾Ðº
                                    })
                                }
                            }
                        })
                    });
                    
                    if (createResponse.ok) {
                        const data = await createResponse.json();
                        storage.gistId = data.id;
                        localStorage.setItem('gistId', data.id);
                        localStorage.setItem('githubToken', token);
                        storage.isInitialized = true;
                        storage.lastSync = Date.now();
                        return { success: true, isNew: true };
                    }
                    
                    return { success: false, error: 'Failed to create gist' };
                } catch (error) {
                    console.error('GitHub storage init error:', error);
                    return { success: false, error: error.message };
                }
            },

            // ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ - Ð²ÑÐµÐ³Ð´Ð° ÑÐ½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ñ€Ð¾Ð±ÑƒÐµÑ‚ GitHub, Ð¿Ð¾Ñ‚Ð¾Ð¼ localStorage
            get: async (key) => {
                // Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ñ€Ð¾Ð±ÑƒÐµÐ¼ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð¸Ð· GitHub
                if (storage.isInitialized && storage.gistId && storage.token) {
                    try {
                        const response = await fetch(`https://api.github.com/gists/${storage.gistId}`, {
                            headers: {
                                'Authorization': `token ${storage.token}`
                            }
                        });
                        
                        if (response.ok) {
                            const gist = await response.json();
                            const content = JSON.parse(gist.files['data.json'].content);
                            const value = content[key];
                            
                            if (value !== undefined) {
                                // Ð¡Ð¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð² localStorage ÐºÐ°Ðº ÐºÑÑˆ
                                localStorage.setItem(key, JSON.stringify(value));
                                storage.lastSync = Date.now();
                                return { value: JSON.stringify(value) };
                            }
                        }
                    } catch (error) {
                        console.log('Failed to fetch from GitHub, using local storage');
                    }
                }
                
                // Fallback Ð½Ð° localStorage
                const localValue = localStorage.getItem(key);
                return localValue ? { value: localValue } : null;
            },

            set: async (key, value) => {
                const parsedValue = JSON.parse(value);
                
                // Ð’ÑÐµÐ³Ð´Ð° ÑÐ¾Ñ…Ñ€Ð°Ð½ÑÐµÐ¼ Ð² localStorage
                localStorage.setItem(key, value);
                
                // ÐŸÑ‹Ñ‚Ð°ÐµÐ¼ÑÑ ÑÐ¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ Ð² GitHub
                if (storage.isInitialized && storage.gistId && storage.token) {
                    try {
                        // Ð¡Ð½Ð°Ñ‡Ð°Ð»Ð° Ð¿Ð¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ
                        const response = await fetch(`https://api.github.com/gists/${storage.gistId}`, {
                            headers: {
                                'Authorization': `token ${storage.token}`
                            }
                        });
                        
                        if (response.ok) {
                            const gist = await response.json();
                            const content = JSON.parse(gist.files['data.json'].content);
                            
                            // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ
                            content[key] = parsedValue;
                            
                            // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ
                            await fetch(`https://api.github.com/gists/${storage.gistId}`, {
                                method: 'PATCH',
                                headers: {
                                    'Authorization': `token ${storage.token}`,
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    files: {
                                        'data.json': {
                                            content: JSON.stringify(content)
                                        }
                                    }
                                })
                            });
                            
                            storage.lastSync = Date.now();
                        }
                    } catch (error) {
                        console.log('Failed to save to GitHub, data saved locally only');
                    }
                }
                
                return { key, value };
            },

            delete: async (key) => {
                localStorage.removeItem(key);
                
                if (storage.isInitialized && storage.gistId && storage.token) {
                    try {
                        const response = await fetch(`https://api.github.com/gists/${storage.gistId}`, {
                            headers: {
                                'Authorization': `token ${storage.token}`
                            }
                        });
                        
                        if (response.ok) {
                            const gist = await response.json();
                            const content = JSON.parse(gist.files['data.json'].content);
                            
                            delete content[key];
                            
                            await fetch(`https://api.github.com/gists/${storage.gistId}`, {
                                method: 'PATCH',
                                headers: {
                                    'Authorization': `token ${storage.token}`,
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({
                                    files: {
                                        'data.json': {
                                            content: JSON.stringify(content)
                                        }
                                    }
                                })
                            });
                            
                            storage.lastSync = Date.now();
                        }
                    } catch (error) {
                        console.log('Failed to delete from GitHub');
                    }
                }
                
                return { key, deleted: true };
            },

            // Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð²ÑÐµÑ… Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… Ñ GitHub
            syncAllData: async () => {
                if (!storage.isInitialized || !storage.gistId || !storage.token) {
                    return false;
                }

                try {
                    // ÐŸÐ¾Ð»ÑƒÑ‡Ð°ÐµÐ¼ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· GitHub
                    const response = await fetch(`https://api.github.com/gists/${storage.gistId}`, {
                        headers: {
                            'Authorization': `token ${storage.token}`
                        }
                    });
                    
                    if (response.ok) {
                        const gist = await response.json();
                        const remoteData = JSON.parse(gist.files['data.json'].content);
                        
                        // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ localStorage Ð´Ð°Ð½Ð½Ñ‹Ð¼Ð¸ Ð¸Ð· GitHub
                        Object.keys(remoteData).forEach(key => {
                            localStorage.setItem(key, JSON.stringify(remoteData[key]));
                        });
                        
                        storage.lastSync = Date.now();
                        return true;
                    }
                } catch (error) {
                    console.error('Sync error:', error);
                }
                
                return false;
            },
            
            // ÐŸÑ€Ð¸Ð½ÑƒÐ´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ð°Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð²ÑÐµÑ… Ð»Ð¾ÐºÐ°Ð»ÑŒÐ½Ñ‹Ñ… Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð½Ð° GitHub
            pushAllData: async () => {
                if (!storage.isInitialized || !storage.gistId || !storage.token) {
                    return false;
                }

                try {
                    // Ð¡Ð¾Ð±Ð¸Ñ€Ð°ÐµÐ¼ Ð²ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¸Ð· localStorage
                    const allData = {
                        users: JSON.parse(localStorage.getItem('users') || '[]'),
                        servers: JSON.parse(localStorage.getItem('servers') || '[]'),
                        messages: JSON.parse(localStorage.getItem('messages') || '{}'),
                        dmMessages: JSON.parse(localStorage.getItem('dmMessages') || '{}'),
                        activeVoiceChannels: JSON.parse(localStorage.getItem('activeVoiceChannels') || '{}'),
                        subscriptions: JSON.parse(localStorage.getItem('subscriptions') || '{}') // Ð”Ð¾Ð±Ð°Ð²Ð»ÑÐµÐ¼ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸
                    };
                    
                    // ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð»ÑÐµÐ¼ Ð½Ð° GitHub
                    await fetch(`https://api.github.com/gists/${storage.gistId}`, {
                        method: 'PATCH',
                        headers: {
                            'Authorization': `token ${storage.token}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            files: {
                                'data.json': {
                                    content: JSON.stringify(allData)
                                }
                            }
                        })
                    });
                    
                    storage.lastSync = Date.now();
                    return true;
                } catch (error) {
                    console.error('Push error:', error);
                    return false;
                }
            }
        };

        const ChatApp = () => {
          const [currentView, setCurrentView] = useState('login');
          const [currentUser, setCurrentUser] = useState(null);
          const [servers, setServers] = useState([]);
          const [selectedServer, setSelectedServer] = useState(null);
          const [selectedChannel, setSelectedChannel] = useState(null);
          const [selectedDM, setSelectedDM] = useState(null);
          const [messages, setMessages] = useState({});
          const [dmMessages, setDMMessages] = useState({});
          const [messageInput, setMessageInput] = useState('');
          const [friends, setFriends] = useState([]);
          const [friendRequests, setFriendRequests] = useState([]);
          const [searchUser, setSearchUser] = useState('');
          const [inVoiceChat, setInVoiceChat] = useState(false);
          const [isMuted, setIsMuted] = useState(false);
          const [isVideoOn, setIsVideoOn] = useState(false);
          const [isScreenSharing, setIsScreenSharing] = useState(false);
          const [voiceChannelUsers, setVoiceChannelUsers] = useState([]);
          const [showChannelSettings, setShowChannelSettings] = useState(false);
          const [showInviteModal, setShowInviteModal] = useState(false);
          const [inviteLink, setInviteLink] = useState('');
          const [showProfileSettings, setShowProfileSettings] = useState(false);
          const [profileData, setProfileData] = useState({ avatar: '', status: 'online' });
          const [notifications, setNotifications] = useState([]);
          const [rememberMe, setRememberMe] = useState(false);
          const [activeVoiceChannels, setActiveVoiceChannels] = useState({});
          const [syncEnabled, setSyncEnabled] = useState(false);
          const [syncToken, setSyncToken] = useState('');
          const [showSyncModal, setShowSyncModal] = useState(false);
          const [isSyncing, setIsSyncing] = useState(false);
          const [lastSyncTime, setLastSyncTime] = useState(null);
          
          // ÐÐ¾Ð²Ñ‹Ðµ ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ Ð´Ð»Ñ ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸
          const [hasPremium, setHasPremium] = useState(false);
          const [showPremiumModal, setShowPremiumModal] = useState(false);
          const [promoCode, setPromoCode] = useState('');
          const [showPromoModal, setShowPromoModal] = useState(false);
          const [premiumFeatures] = useState([
            'ðŸŽ¨ ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ Ñ†Ð²ÐµÑ‚Ð¾Ð²Ñ‹Ðµ ÑÑ…ÐµÐ¼Ñ‹',
            'ðŸ”” Ð Ð°ÑÑˆÐ¸Ñ€ÐµÐ½Ð½Ñ‹Ðµ ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ',
            'ðŸ’¾ Ð£Ð²ÐµÐ»Ð¸Ñ‡ÐµÐ½Ð½Ð¾Ðµ Ð¾Ð±Ð»Ð°Ñ‡Ð½Ð¾Ðµ Ñ…Ñ€Ð°Ð½Ð¸Ð»Ð¸Ñ‰Ðµ',
            'ðŸ‘¥ Ð”Ð¾ 50 ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð² Ð² Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ñ‹Ñ… ÐºÐ°Ð½Ð°Ð»Ð°Ñ…',
            'ðŸ“¹ Ð—Ð°Ð¿Ð¸ÑÑŒ Ð²Ð¸Ð´ÐµÐ¾-Ð·Ð²Ð¾Ð½ÐºÐ¾Ð²',
            'ðŸŽ­ Ð­ÐºÑÐºÐ»ÑŽÐ·Ð¸Ð²Ð½Ñ‹Ðµ Ð°Ð²Ð°Ñ‚Ð°Ñ€Ñ‹ Ð¸ Ñ€Ð°Ð¼ÐºÐ¸',
            'âš¡ ÐŸÑ€Ð¸Ð¾Ñ€Ð¸Ñ‚ÐµÑ‚Ð½Ð°Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ°',
            'ðŸ”’ ÐŸÑ€Ð¸Ð²Ð°Ñ‚Ð½Ñ‹Ðµ ÑÐµÑ€Ð²ÐµÑ€Ñ‹ Ñ Ð¿Ð°Ñ€Ð¾Ð»ÐµÐ¼'
          ]);

          const messagesEndRef = useRef(null);
          const localVideoRef = useRef(null);
          const localStreamRef = useRef(null);
          const screenStreamRef = useRef(null);

          useEffect(() => {
            initializeApp();
          }, []);

          const initializeApp = async () => {
            await loadData();
            await checkRememberedUser();
            await checkSyncStatus();
            await checkPremiumStatus();
          };

          // ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ° Ð¿Ñ€ÐµÐ¼Ð¸ÑƒÐ¼ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸
          const checkPremiumStatus = async () => {
            if (!currentUser) return;
            
            try {
              const result = await storage.get(`premium-${currentUser.username}`);
              if (result) {
                const premiumData = JSON.parse(result.value);
                setHasPremium(premiumData.active);
              }
            } catch (error) {
              console.log('No premium subscription found');
            }
          };

          // ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ñ Ð¿Ñ€ÐµÐ¼Ð¸ÑƒÐ¼ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¸
          const activatePremium = async (months = 1) => {
            if (!currentUser) return;
            
            const expiryDate = new Date();
            expiryDate.setMonth(expiryDate.getMonth() + months);
            
            const premiumData = {
              active: true,
              since: new Date().toISOString(),
              expires: expiryDate.toISOString(),
              plan: months >= 12 ? 'yearly' : months >= 6 ? 'half-yearly' : 'monthly'
            };
            
            await storage.set(`premium-${currentUser.username}`, JSON.stringify(premiumData));
            setHasPremium(true);
            setShowPremiumModal(false);
            addNotification(`ðŸŽ‰ ÐŸÐ¾Ð·Ð´Ñ€Ð°Ð²Ð»ÑÐµÐ¼! ÐŸÑ€ÐµÐ¼Ð¸ÑƒÐ¼ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ° Ð°ÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ð½Ð° ${months} Ð¼ÐµÑÑÑ†(ÐµÐ²)!`, 'success');
          };

          // ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ñ Ð¿Ð¾ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ñƒ
          const activateWithPromo = async () => {
            const validPromoCodes = {
              'FREEMONTH2024': 1,
              'WELCOME50': 1,
              'CHATHUBFREE': 3,
              'PREMIUM2024': 6
            };
            
            const code = promoCode.toUpperCase().trim();
            
            if (validPromoCodes[code]) {
              await activatePremium(validPromoCodes[code]);
              setPromoCode('');
              setShowPromoModal(false);
            } else {
              addNotification('ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ð¹ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´', 'error');
            }
          };

          const checkSyncStatus = async () => {
            const token = localStorage.getItem('githubToken');
            const gistId = localStorage.getItem('gistId');
            
            if (token && gistId) {
              setSyncToken(token);
              storage.token = token;
              storage.gistId = gistId;
              storage.isInitialized = true;
              setSyncEnabled(true);
              
              // ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
              await syncWithGitHub();
            }
          };

          const enableSync = async (token) => {
            setIsSyncing(true);
            
            try {
              const result = await storage.init(token);
              
              if (result.success) {
                setSyncToken(token);
                setSyncEnabled(true);
                setShowSyncModal(false);
                
                // Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€ÑƒÐµÐ¼ Ð´Ð°Ð½Ð½Ñ‹Ðµ ÑÑ€Ð°Ð·Ñƒ Ð¿Ð¾ÑÐ»Ðµ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
                await syncWithGitHub();
                
                addNotification(
                  result.isNew 
                    ? 'Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°! Ð¡Ð¾Ð·Ð´Ð°Ð½ Ð½Ð¾Ð²Ñ‹Ð¹ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹ Ð´Ð°Ð½Ð½Ñ‹Ñ….' 
                    : 'Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°! ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½ Ðº ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰ÐµÐ¼Ñƒ Ñ€ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸ÑŽ.', 
                  'success'
                );
              } else {
                addNotification('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº GitHub: ' + result.error, 'error');
              }
            } catch (error) {
              addNotification('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº GitHub', 'error');
            } finally {
              setIsSyncing(false);
            }
          };

          const syncWithGitHub = async () => {
            if (!syncEnabled) return;
            
            setIsSyncing(true);
            try {
              const success = await storage.syncAllData();
              if (success) {
                // ÐŸÐµÑ€ÐµÐ·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÐµÐ¼ Ð²ÑÐµ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð¿Ð¾ÑÐ»Ðµ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸
                await loadServers();
                await loadFriends();
                await loadMessages();
                await loadDMMessages();
                setLastSyncTime(new Date().toLocaleTimeString());
              }
            } catch (error) {
              console.log('Sync completed with local data');
            } finally {
              setIsSyncing(false);
            }
          };

          const pushToGitHub = async () => {
            if (!syncEnabled) return;
            
            setIsSyncing(true);
            try {
              const success = await storage.pushAllData();
              if (success) {
                setLastSyncTime(new Date().toLocaleTimeString());
                addNotification('Ð”Ð°Ð½Ð½Ñ‹Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ñ‹ Ð½Ð° GitHub!', 'success');
              }
            } catch (error) {
              addNotification('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð½Ð° GitHub', 'error');
            } finally {
              setIsSyncing(false);
            }
          };

          const disableSync = () => {
            localStorage.removeItem('githubToken');
            localStorage.removeItem('gistId');
            setSyncToken('');
            setSyncEnabled(false);
            storage.token = null;
            storage.gistId = null;
            storage.isInitialized = false;
            addNotification('Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð¾Ñ‚ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°', 'info');
          };

          const checkRememberedUser = async () => {
            try {
              const remembered = await storage.get('rememberedUser');
              if (remembered) {
                const userData = JSON.parse(remembered.value);
                setCurrentUser(userData);
                setCurrentView('app');
              }
            } catch (error) {
              console.log('No remembered user');
            }
          };

          const loadData = async () => {
            try {
              const usersData = await storage.get('users');
              if (!usersData) await storage.set('users', JSON.stringify([]));
              
              const serversData = await storage.get('servers');
              if (!serversData) await storage.set('servers', JSON.stringify([]));
              
              const messagesData = await storage.get('messages');
              if (!messagesData) await storage.set('messages', JSON.stringify({}));

              const dmData = await storage.get('dmMessages');
              if (!dmData) await storage.set('dmMessages', JSON.stringify({}));

              const activeVCData = await storage.get('activeVoiceChannels');
              if (activeVCData) setActiveVoiceChannels(JSON.parse(activeVCData.value));
            } catch (error) {
              console.log('Initializing storage');
            }
          };

          const addNotification = (message, type = 'info') => {
            const id = Date.now().toString();
            const notification = { id, message, type };
            setNotifications(prev => [...prev, notification]);
            
            setTimeout(() => {
              setNotifications(prev => prev.filter(n => n.id !== id));
            }, 5000);
          };

          const scrollToBottom = () => {
            messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
          };

          useEffect(() => {
            scrollToBottom();
          }, [messages, dmMessages, selectedChannel, selectedDM]);

          // ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ ÐºÐ°Ð¶Ð´Ñ‹Ðµ 10 ÑÐµÐºÑƒÐ½Ð´
          useEffect(() => {
            if (!syncEnabled || !currentUser) return;
            
            const interval = setInterval(async () => {
              await syncWithGitHub();
            }, 10000);

            return () => clearInterval(interval);
          }, [syncEnabled, currentUser]);

          // ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¸Ð½Ñ‚ÐµÑ€Ð²Ð°Ð» Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð´Ð°Ð½Ð½Ñ‹Ñ…
          useEffect(() => {
            if (!currentUser) return;
            
            const interval = setInterval(async () => {
              await loadServers();
              await loadMessages();
              await loadFriends();
              await loadDMMessages();
              await updateVoiceChannels();
            }, 2000);

            return () => clearInterval(interval);
          }, [currentUser, selectedServer, selectedChannel, selectedDM]);

          const updateVoiceChannels = async () => {
            try {
              const result = await storage.get('activeVoiceChannels');
              if (result) {
                const activeChannels = JSON.parse(result.value);
                setActiveVoiceChannels(activeChannels);
                
                if (selectedChannel && selectedChannel.type === 'voice' && inVoiceChat) {
                  const channelKey = `${selectedServer.id}-${selectedChannel.id}`;
                  if (activeChannels[channelKey]) {
                    setVoiceChannelUsers(activeChannels[channelKey]);
                  }
                }
              }
            } catch (error) {
              console.log('Error updating voice channels');
            }
          };

          const loadServers = async () => {
            try {
              const result = await storage.get('servers');
              if (result) {
                const allServers = JSON.parse(result.value);
                const userServers = allServers.filter(s => s.members.includes(currentUser.username));
                setServers(userServers);
              }
            } catch (error) {
              console.log('No servers yet');
            }
          };

          const loadMessages = async () => {
            if (!selectedChannel) return;
            try {
              const result = await storage.get('messages');
              if (result) setMessages(JSON.parse(result.value));
            } catch (error) {
              console.log('No messages yet');
            }
          };

          const loadDMMessages = async () => {
            try {
              const result = await storage.get('dmMessages');
              if (result) setDMMessages(JSON.parse(result.value));
            } catch (error) {
              console.log('No DM messages yet');
            }
          };

          const loadFriends = async () => {
            try {
              const result = await storage.get(`friends-${currentUser.username}`);
              if (result) setFriends(JSON.parse(result.value));
            } catch (error) {
              setFriends([]);
            }

            try {
              const reqResult = await storage.get(`friendrequests-${currentUser.username}`);
              if (reqResult) setFriendRequests(JSON.parse(reqResult.value));
            } catch (error) {
              setFriendRequests([]);
            }
          };

          const handleRegister = async (e) => {
            e.preventDefault();
            const username = e.target.username.value;
            const email = e.target.email.value;
            const password = e.target.password.value;

            try {
              const result = await storage.get('users');
              const users = result ? JSON.parse(result.value) : [];
              
              if (users.find(u => u.username === username)) {
                alert('ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ ÑƒÐ¶Ðµ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÐµÑ‚');
                return;
              }

              const newUser = { username, email, password, avatar: '', status: 'online' };
              users.push(newUser);
              await storage.set('users', JSON.stringify(users));
              
              setCurrentUser(newUser);
              setProfileData({ avatar: '', status: 'online' });
              
              if (rememberMe) {
                await storage.set('rememberedUser', JSON.stringify(newUser));
              }
              
              await loadServers();
              await loadFriends();
              setCurrentView('app');
              addNotification(`Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ, ${username}!`, 'success');
            } catch (error) {
              alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸');
            }
          };

          const handleLogin = async (e) => {
            e.preventDefault();
            const username = e.target.username.value;
            const password = e.target.password.value;
            const remember = e.target.remember ? e.target.remember.checked : false;

            try {
              const result = await storage.get('users');
              const users = result ? JSON.parse(result.value) : [];
              const user = users.find(u => u.username === username && u.password === password);
              
              if (user) {
                setCurrentUser(user);
                setProfileData({ avatar: user.avatar || '', status: user.status || 'online' });
                
                if (remember) {
                  await storage.set('rememberedUser', JSON.stringify(user));
                } else {
                  await storage.delete('rememberedUser');
                }
                
                await loadServers();
                await loadFriends();
                await checkPremiumStatus();
                setCurrentView('app');
                addNotification(`Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ, ${username}!`, 'success');
              } else {
                alert('ÐÐµÐ²ÐµÑ€Ð½Ñ‹Ðµ Ð´Ð°Ð½Ð½Ñ‹Ðµ');
              }
            } catch (error) {
              alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð²Ñ…Ð¾Ð´Ð°');
            }
          };

          const handleLogout = () => {
            if (localStreamRef.current) {
              localStreamRef.current.getTracks().forEach(track => track.stop());
            }
            if (screenStreamRef.current) {
              screenStreamRef.current.getTracks().forEach(track => track.stop());
            }
            
            if (selectedChannel && selectedChannel.type === 'voice' && inVoiceChat) {
              leaveVoiceChannel();
            }
            
            setCurrentUser(null);
            setServers([]);
            setSelectedServer(null);
            setSelectedChannel(null);
            setMessages({});
            setFriends([]);
            setHasPremium(false);
            setCurrentView('login');
          };

          const updateProfile = async () => {
            try {
              const result = await storage.get('users');
              const users = result ? JSON.parse(result.value) : [];
              const userIndex = users.findIndex(u => u.username === currentUser.username);
              
              if (userIndex !== -1) {
                users[userIndex] = { ...users[userIndex], ...profileData };
                await storage.set('users', JSON.stringify(users));
                setCurrentUser(users[userIndex]);
                
                const remembered = await storage.get('rememberedUser');
                if (remembered) {
                  await storage.set('rememberedUser', JSON.stringify(users[userIndex]));
                }
                
                setShowProfileSettings(false);
                addNotification('ÐŸÑ€Ð¾Ñ„Ð¸Ð»ÑŒ Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½!', 'success');
              }
            } catch (error) {
              alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ');
            }
          };

          const createServer = async () => {
            const name = prompt('ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ÑÐµÑ€Ð²ÐµÑ€Ð°:');
            if (!name) return;

            try {
              const result = await storage.get('servers');
              const allServers = result ? JSON.parse(result.value) : [];
              
              const serverId = Date.now().toString();
              allServers.push({
                id: serverId,
                name,
                owner: currentUser.username,
                members: [currentUser.username],
                channels: [
                  { id: '1', name: 'Ð¾Ð±Ñ‰Ð¸Ð¹', type: 'text' },
                  { id: '2', name: 'Ð“Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð¹', type: 'voice' }
                ]
              });

              await storage.set('servers', JSON.stringify(allServers));
              await loadServers();
              addNotification(`Ð¡ÐµÑ€Ð²ÐµÑ€ "${name}" ÑÐ¾Ð·Ð´Ð°Ð½!`, 'success');
            } catch (error) {
              alert('ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÑÐµÑ€Ð²ÐµÑ€Ð°');
            }
          };

          const createChannel = async (type) => {
            const name = prompt(`ÐÐ°Ð·Ð²Ð°Ð½Ð¸Ðµ ${type === 'text' ? 'Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ð¾Ð³Ð¾' : type === 'voice' ? 'Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð³Ð¾' : 'Ñ‚Ñ€Ð¸Ð±ÑƒÐ½Ñ‹'} ÐºÐ°Ð½Ð°Ð»Ð°:`);
            if (!name) return;

            try {
              const result = await storage.get('servers');
              const allServers = result ? JSON.parse(result.value) : [];
              const serverIndex = allServers.findIndex(s => s.id === selectedServer.id);
              
              if (serverIndex !== -1) {
                const newChannel = {
                  id: Date.now().toString(),
                  name,
                  type
                };
                allServers[serverIndex].channels.push(newChannel);
                await storage.set('servers', JSON.stringify(allServers));
                await loadServers();
                addNotification(`ÐšÐ°Ð½Ð°Ð» "${name}" ÑÐ¾Ð·Ð´Ð°Ð½!`, 'success');
              }
            } catch (error) {
              alert('ÐžÑˆÐ¸Ð±ÐºÐ° ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ ÐºÐ°Ð½Ð°Ð»Ð°');
            }
          };

          const deleteChannel = async (channelId) => {
            if (!confirm('Ð£Ð´Ð°Ð»Ð¸Ñ‚ÑŒ ÐºÐ°Ð½Ð°Ð»?')) return;

            try {
              const result = await storage.get('servers');
              const allServers = result ? JSON.parse(result.value) : [];
              const serverIndex = allServers.findIndex(s => s.id === selectedServer.id);
              
              if (serverIndex !== -1) {
                allServers[serverIndex].channels = allServers[serverIndex].channels.filter(c => c.id !== channelId);
                await storage.set('servers', JSON.stringify(allServers));
                if (selectedChannel?.id === channelId) setSelectedChannel(null);
                await loadServers();
                addNotification('ÐšÐ°Ð½Ð°Ð» ÑƒÐ´Ð°Ð»ÐµÐ½', 'info');
              }
            } catch (error) {
              alert('ÐžÑˆÐ¸Ð±ÐºÐ° ÑƒÐ´Ð°Ð»ÐµÐ½Ð¸Ñ ÐºÐ°Ð½Ð°Ð»Ð°');
            }
          };

          const generateInvite = () => {
            const link = `${window.location.origin}${window.location.pathname}?invite=${selectedServer.id}`;
            setInviteLink(link);
            setShowInviteModal(true);
          };

          const copyInviteLink = () => {
            navigator.clipboard.writeText(inviteLink);
            addNotification('Ð¡ÑÑ‹Ð»ÐºÐ° ÑÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð° Ð² Ð±ÑƒÑ„ÐµÑ€ Ð¾Ð±Ð¼ÐµÐ½Ð°!', 'success');
          };

          const sendDirectInvite = async (friendUsername) => {
            if (!selectedServer) return;
            
            try {
              const result = await storage.get('dmMessages');
              const allDMs = result ? JSON.parse(result.value) : {};
              
              const dmKey = [currentUser.username, friendUsername].sort().join('-');
              if (!allDMs[dmKey]) allDMs[dmKey] = [];

              const inviteMessage = {
                id: Date.now().toString(),
                author: currentUser.username,
                content: '',
                timestamp: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' }),
                type: 'invite',
                serverId: selectedServer.id,
                serverName: selectedServer.name
              };

              allDMs[dmKey].push(inviteMessage);
              await storage.set('dmMessages', JSON.stringify(allDMs));
              setDMMessages(allDMs);
              addNotification(`ÐŸÑ€Ð¸Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¾ ${friendUsername}!`, 'success');
            } catch (error) {
              alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð¿Ñ€Ð¸Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ñ');
            }
          };

          const handleInviteAccept = async (serverId, serverName) => {
            try {
              const result = await storage.get('servers');
              const allServers = result ? JSON.parse(result.value) : [];
              const serverIndex = allServers.findIndex(s => s.id === serverId);
              
              if (serverIndex !== -1 && !allServers[serverIndex].members.includes(currentUser.username)) {
                allServers[serverIndex].members.push(currentUser.username);
                await storage.set('servers', JSON.stringify(allServers));
                await loadServers();
                addNotification(`Ð’Ñ‹ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ð»Ð¸ÑÑŒ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ "${serverName}"!`, 'success');
              }
            } catch (error) {
              alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ');
            }
          };

          const joinServerByInvite = async (serverId) => {
            try {
              const result = await storage.get('servers');
              const allServers = result ? JSON.parse(result.value) : [];
              const serverIndex = allServers.findIndex(s => s.id === serverId);
              
              if (serverIndex !== -1 && !allServers[serverIndex].members.includes(currentUser.username)) {
                allServers[serverIndex].members.push(currentUser.username);
                await storage.set('servers', JSON.stringify(allServers));
                await loadServers();
                addNotification('Ð’Ñ‹ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ð»Ð¸ÑÑŒ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ!', 'success');
              }
            } catch (error) {
              alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ');
            }
          };

          useEffect(() => {
            const urlParams = new URLSearchParams(window.location.search);
            const inviteId = urlParams.get('invite');
            if (inviteId && currentUser) {
              joinServerByInvite(inviteId);
              window.history.replaceState({}, document.title, window.location.pathname);
            }
          }, [currentUser]);

          const sendMessage = async () => {
            if (!messageInput.trim()) return;

            try {
              if (selectedChannel) {
                const result = await storage.get('messages');
                const allMessages = result ? JSON.parse(result.value) : {};
                
                const channelKey = `${selectedServer.id}-${selectedChannel.id}`;
                if (!allMessages[channelKey]) allMessages[channelKey] = [];

                allMessages[channelKey].push({
                  id: Date.now().toString(),
                  author: currentUser.username,
                  content: messageInput,
                  timestamp: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })
                });

                await storage.set('messages', JSON.stringify(allMessages));
                setMessages(allMessages);
              } else if (selectedDM) {
                const result = await storage.get('dmMessages');
                const allDMs = result ? JSON.parse(result.value) : {};
                
                const dmKey = [currentUser.username, selectedDM].sort().join('-');
                if (!allDMs[dmKey]) allDMs[dmKey] = [];

                allDMs[dmKey].push({
                  id: Date.now().toString(),
                  author: currentUser.username,
                  content: messageInput,
                  timestamp: new Date().toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' })
                });

                await storage.set('dmMessages', JSON.stringify(allDMs));
                setDMMessages(allDMs);
              }
              
              setMessageInput('');
            } catch (error) {
              console.log('Error sending message');
            }
          };

          const sendFriendRequest = async () => {
            if (!searchUser.trim()) return;

            try {
              const result = await storage.get('users');
              const users = result ? JSON.parse(result.value) : [];
              const targetUser = users.find(u => u.username === searchUser);

              if (!targetUser) {
                alert('ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ Ð½Ð°Ð¹Ð´ÐµÐ½');
                return;
              }

              if (targetUser.username === currentUser.username) {
                alert('ÐÐµÐ»ÑŒÐ·Ñ Ð´Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ ÑÐµÐ±Ñ Ð² Ð´Ñ€ÑƒÐ·ÑŒÑ');
                return;
              }

              try {
                const reqResult = await storage.get(`friendrequests-${targetUser.username}`);
                const requests = reqResult ? JSON.parse(reqResult.value) : [];
                
                if (requests.includes(currentUser.username)) {
                  alert('Ð—Ð°Ð¿Ñ€Ð¾Ñ ÑƒÐ¶Ðµ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½');
                  return;
                }

                requests.push(currentUser.username);
                await storage.set(`friendrequests-${targetUser.username}`, JSON.stringify(requests));
                addNotification(`Ð—Ð°Ð¿Ñ€Ð¾Ñ Ð² Ð´Ñ€ÑƒÐ·ÑŒÑ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½ ${searchUser}!`, 'success');
                setSearchUser('');
              } catch (error) {
                await storage.set(`friendrequests-${targetUser.username}`, JSON.stringify([currentUser.username]));
                addNotification(`Ð—Ð°Ð¿Ñ€Ð¾Ñ Ð² Ð´Ñ€ÑƒÐ·ÑŒÑ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½ ${searchUser}!`, 'success');
                setSearchUser('');
              }
            } catch (error) {
              alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¸ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°');
            }
          };

          const acceptFriendRequest = async (username) => {
            try {
              const myFriends = friends.includes(username) ? friends : [...friends, username];
              await storage.set(`friends-${currentUser.username}`, JSON.stringify(myFriends));
              
              try {
                const theirResult = await storage.get(`friends-${username}`);
                const theirFriends = theirResult ? JSON.parse(theirResult.value) : [];
                if (!theirFriends.includes(currentUser.username)) {
                  theirFriends.push(currentUser.username);
                  await storage.set(`friends-${username}`, JSON.stringify(theirFriends));
                }
              } catch (error) {
                await storage.set(`friends-${username}`, JSON.stringify([currentUser.username]));
              }

              const updatedRequests = friendRequests.filter(r => r !== username);
              await storage.set(`friendrequests-${currentUser.username}`, JSON.stringify(updatedRequests));
              await loadFriends();
              addNotification(`${username} Ñ‚ÐµÐ¿ÐµÑ€ÑŒ Ð²Ð°Ñˆ Ð´Ñ€ÑƒÐ³!`, 'success');
            } catch (error) {
              alert('ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸Ð½ÑÑ‚Ð¸Ñ Ð·Ð°Ð¿Ñ€Ð¾ÑÐ°');
            }
          };

          const declineFriendRequest = async (username) => {
            const updatedRequests = friendRequests.filter(r => r !== username);
            await storage.set(`friendrequests-${currentUser.username}`, JSON.stringify(updatedRequests));
            setFriendRequests(updatedRequests);
            addNotification(`Ð—Ð°Ð¿Ñ€Ð¾Ñ Ð¾Ñ‚ ${username} Ð¾Ñ‚ÐºÐ»Ð¾Ð½ÐµÐ½`, 'info');
          };

          const openDM = (username) => {
            setSelectedServer(null);
            setSelectedChannel(null);
            setSelectedDM(username);
          };

          const toggleVideo = async () => {
            if (!isVideoOn) {
              try {
                const stream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                localStreamRef.current = stream;
                if (localVideoRef.current) {
                  localVideoRef.current.srcObject = stream;
                }
                setIsVideoOn(true);
                addNotification('ÐšÐ°Ð¼ÐµÑ€Ð° Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°', 'success');
              } catch (error) {
                alert('ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð¿Ð¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Ð´Ð¾ÑÑ‚ÑƒÐ¿ Ðº ÐºÐ°Ð¼ÐµÑ€Ðµ/Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½Ñƒ');
              }
            } else {
              if (localStreamRef.current) {
                localStreamRef.current.getTracks().forEach(track => track.stop());
              }
              setIsVideoOn(false);
              addNotification('ÐšÐ°Ð¼ÐµÑ€Ð° Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°', 'info');
            }
          };

          const toggleScreenShare = async () => {
            if (!isScreenSharing) {
              try {
                const stream = await navigator.mediaDevices.getDisplayMedia({ video: true });
                screenStreamRef.current = stream;
                setIsScreenSharing(true);
                
                if (localVideoRef.current) {
                  localVideoRef.current.srcObject = stream;
                }
                
                stream.getVideoTracks()[0].onended = () => {
                  setIsScreenSharing(false);
                  if (isVideoOn) {
                    toggleVideo();
                    setTimeout(toggleVideo, 100);
                  }
                };
                addNotification('Ð”ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ ÑÐºÑ€Ð°Ð½Ð° Ð½Ð°Ñ‡Ð°Ñ‚Ð°', 'success');
              } catch (error) {
                alert('ÐÐµ ÑƒÐ´Ð°Ð»Ð¾ÑÑŒ Ð½Ð°Ñ‡Ð°Ñ‚ÑŒ Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸ÑŽ ÑÐºÑ€Ð°Ð½Ð°');
              }
            } else {
              if (screenStreamRef.current) {
                screenStreamRef.current.getTracks().forEach(track => track.stop());
              }
              setIsScreenSharing(false);
              addNotification('Ð”ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ ÑÐºÑ€Ð°Ð½Ð° Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð°', 'info');
            }
          };

          const joinVoiceChannel = async () => {
            setInVoiceChat(true);
            
            const channelKey = `${selectedServer.id}-${selectedChannel.id}`;
            try {
              const result = await storage.get('activeVoiceChannels');
              const activeChannels = result ? JSON.parse(result.value) : {};
              
              if (!activeChannels[channelKey]) {
                activeChannels[channelKey] = [];
              }
              
              if (!activeChannels[channelKey].includes(currentUser.username)) {
                activeChannels[channelKey].push(currentUser.username);
                await storage.set('activeVoiceChannels', JSON.stringify(activeChannels));
                setActiveVoiceChannels(activeChannels);
                setVoiceChannelUsers(activeChannels[channelKey]);
              }
              
              addNotification(`Ð’Ñ‹ Ð¿Ñ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ð»Ð¸ÑÑŒ Ðº ${selectedChannel.name}`, 'success');
            } catch (error) {
              console.log('Error joining voice channel');
            }
            
            try {
              const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
              localStreamRef.current = stream;
            } catch (error) {
              console.log('Mic access denied');
            }
          };

          const leaveVoiceChannel = () => {
            if (localStreamRef.current) {
              localStreamRef.current.getTracks().forEach(track => track.stop());
            }
            if (screenStreamRef.current) {
              screenStreamRef.current.getTracks().forEach(track => track.stop());
            }
            
            if (selectedChannel) {
              const channelKey = `${selectedServer.id}-${selectedChannel.id}`;
              removeUserFromVoiceChannel(channelKey, currentUser.username);
            }
            
            setInVoiceChat(false);
            setIsVideoOn(false);
            setIsScreenSharing(false);
            setIsMuted(false);
            setVoiceChannelUsers([]);
            addNotification('Ð’Ñ‹ Ð¿Ð¾ÐºÐ¸Ð½ÑƒÐ»Ð¸ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð¹ ÐºÐ°Ð½Ð°Ð»', 'info');
          };

          const removeUserFromVoiceChannel = async (channelKey, username) => {
            try {
              const result = await storage.get('activeVoiceChannels');
              const activeChannels = result ? JSON.parse(result.value) : {};
              
              if (activeChannels[channelKey]) {
                activeChannels[channelKey] = activeChannels[channelKey].filter(u => u !== username);
                if (activeChannels[channelKey].length === 0) {
                  delete activeChannels[channelKey];
                }
                await storage.set('activeVoiceChannels', JSON.stringify(activeChannels));
                setActiveVoiceChannels(activeChannels);
              }
            } catch (error) {
              console.log('Error removing user from voice channel');
            }
          };

          const toggleMute = () => {
            if (localStreamRef.current) {
              const audioTrack = localStreamRef.current.getAudioTracks()[0];
              if (audioTrack) {
                audioTrack.enabled = !audioTrack.enabled;
                setIsMuted(!audioTrack.enabled);
                addNotification(audioTrack.enabled ? 'ÐœÐ¸ÐºÑ€Ð¾Ñ„Ð¾Ð½ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½' : 'ÐœÐ¸ÐºÑ€Ð¾Ñ„Ð¾Ð½ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½', 'info');
              }
            }
          };

          const renderVoiceChannelParticipants = () => {
            if (!voiceChannelUsers.length) return null;
            
            return (
              <div className="mt-6 grid grid-cols-2 md:grid-cols-3 gap-4 max-w-2xl mx-auto">
                {voiceChannelUsers.map((user, idx) => (
                  <div key={idx} className="bg-gray-800 rounded-lg p-4 flex flex-col items-center">
                    <div className="w-16 h-16 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-xl mb-2">
                      {user[0].toUpperCase()}
                    </div>
                    <span className="text-white text-sm font-medium truncate w-full text-center">{user}</span>
                    {user === currentUser.username && (
                      <div className="mt-2 flex space-x-2">
                        {!isMuted && <Volume2 className="w-4 h-4 text-green-400" />}
                        {isMuted && <MicOff className="w-4 h-4 text-red-400" />}
                        {isVideoOn && <Video className="w-4 h-4 text-green-400" />}
                        {isScreenSharing && <Monitor className="w-4 h-4 text-green-400" />}
                      </div>
                    )}
                  </div>
                ))}
              </div>
            );
          };

          if (currentView === 'login') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-800 flex items-center justify-center p-4">
                <div className="bg-gray-900 rounded-2xl shadow-2xl p-8 w-full max-w-md">
                  <div className="text-center mb-8">
                    <div className="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full mb-4">
                      <MessageCircle />
                    </div>
                    <h1 className="text-3xl font-bold text-white mb-2">ChatHub Online</h1>
                    <p className="text-gray-400">Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· GitHub</p>
                  </div>

                  <form onSubmit={handleLogin} className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-300 mb-2">Ð˜Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ</label>
                      <input name="username" type="text" required className="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500 transition" placeholder="Ð’Ð°ÑˆÐµ Ð¸Ð¼Ñ" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-300 mb-2">ÐŸÐ°Ñ€Ð¾Ð»ÑŒ</label>
                      <input name="password" type="password" required className="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500 transition" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
                    </div>
                    <div className="flex items-center">
                      <input id="remember" name="remember" type="checkbox" className="h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-700 rounded bg-gray-800" />
                      <label htmlFor="remember" className="ml-2 block text-sm text-gray-300">
                        Ð—Ð°Ð¿Ð¾Ð¼Ð½Ð¸Ñ‚ÑŒ Ð¼ÐµÐ½Ñ
                      </label>
                    </div>
                    <button type="submit" className="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-semibold hover:from-indigo-700 hover:to-purple-700 transition">
                      Ð’Ð¾Ð¹Ñ‚Ð¸
                    </button>
                  </form>

                  <div className="mt-6 text-center">
                    <p className="text-gray-400">
                      ÐÐµÑ‚ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚Ð°?{' '}
                      <button onClick={() => setCurrentView('register')} className="text-indigo-400 hover:text-indigo-300 font-semibold">
                        Ð—Ð°Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒÑÑ
                      </button>
                    </p>
                  </div>

                  <div className="mt-4 text-center">
                    <button 
                      onClick={() => setShowSyncModal(true)}
                      className="text-gray-400 hover:text-white text-sm flex items-center justify-center space-x-2 mx-auto"
                    >
                      <Github className="w-4 h-4" />
                      <span>ÐÐ°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ñ GitHub</span>
                    </button>
                  </div>

                  {/* ÐšÐ½Ð¾Ð¿ÐºÐ° Premium Ð² Ñ„Ð¾Ñ€Ð¼Ðµ Ð²Ñ…Ð¾Ð´Ð° */}
                  <div className="mt-6 text-center">
                    <button 
                      onClick={() => setShowPremiumModal(true)}
                      className="w-full py-3 premium-badge text-black font-bold rounded-lg flex items-center justify-center space-x-2"
                    >
                      <Crown className="w-5 h-5" />
                      <span>ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Premium ÑÐ¾ ÑÐºÐ¸Ð´ÐºÐ¾Ð¹</span>
                    </button>
                  </div>
                </div>

                {/* ÐœÐ¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ */}
                {showSyncModal && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-gray-800 rounded-xl p-6 w-96">
                      <h3 className="text-white text-xl font-bold mb-4 flex items-center">
                        <Github className="w-6 h-6 mr-2" />
                        Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ GitHub
                      </h3>
                      
                      {syncEnabled ? (
                        <div className="space-y-4">
                          <div className="bg-green-900 bg-opacity-30 p-3 rounded-lg border border-green-700">
                            <div className="flex items-center">
                              <Cloud className="w-5 h-5 text-green-400 mr-2" />
                              <span className="text-green-400 font-semibold">Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°</span>
                            </div>
                            <p className="text-gray-300 text-sm mt-2">
                              Ð’Ð°ÑˆÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ
                            </p>
                            {lastSyncTime && (
                              <p className="text-gray-400 text-xs mt-1">
                                ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ: {lastSyncTime}
                              </p>
                            )}
                          </div>
                          <div className="flex space-x-2">
                            <button 
                              onClick={syncWithGitHub}
                              disabled={isSyncing}
                              className="flex-1 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition disabled:opacity-50 flex items-center justify-center space-x-2"
                            >
                              <RefreshCw className={`w-4 h-4 ${isSyncing ? 'animate-spin' : ''}`} />
                              <span>{isSyncing ? 'Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ...' : 'Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ'}</span>
                            </button>
                            <button 
                              onClick={pushToGitHub}
                              disabled={isSyncing}
                              className="flex-1 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition disabled:opacity-50"
                            >
                              ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ
                            </button>
                          </div>
                          <button 
                            onClick={disableSync}
                            className="w-full py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition"
                          >
                            ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑŽ
                          </button>
                          <button 
                            onClick={() => setShowSyncModal(false)}
                            className="w-full py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition"
                          >
                            Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ
                          </button>
                        </div>
                      ) : (
                        <div className="space-y-4">
                          <p className="text-gray-300">
                            Ð”Ð»Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¼ÐµÐ¶Ð´Ñƒ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°Ð¼Ð¸ Ð½ÑƒÐ¶ÐµÐ½ GitHub Personal Access Token.
                          </p>
                          
                          <ol className="text-gray-300 text-sm space-y-2 list-decimal list-inside">
                            <li>ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² <a href="https://github.com/settings/tokens" target="_blank" className="text-indigo-400 hover:underline">GitHub Settings â†’ Developer settings â†’ Personal access tokens</a></li>
                            <li>ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ "Generate new token"</li>
                            <li>Ð”Ð°Ð¹Ñ‚Ðµ Ð¸Ð¼Ñ Ñ‚Ð¾ÐºÐµÐ½Ñƒ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ "ChatHub")</li>
                            <li>Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÑ€Ð¾Ðº Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ "No expiration")</li>
                            <li>ÐžÑ‚Ð¼ÐµÑ‚ÑŒÑ‚Ðµ Ð³Ð°Ð»Ð¾Ñ‡ÐºÑƒ "gist" (Create gists)</li>
                            <li>ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ "Generate token" Ð¸ ÑÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ‚Ð¾ÐºÐµÐ½</li>
                            <li>Ð’ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ñ‚Ð¾ÐºÐµÐ½ Ð½Ð¸Ð¶Ðµ:</li>
                          </ol>
                          
                          <div>
                            <input 
                              type="text" 
                              value={syncToken}
                              onChange={(e) => setSyncToken(e.target.value)}
                              className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-indigo-500" 
                              placeholder="ghp_xxxxxxxxxxxxxxxxxxxx"
                            />
                          </div>
                          
                          <div className="flex space-x-2">
                            <button 
                              onClick={() => enableSync(syncToken)}
                              disabled={isSyncing}
                              className="flex-1 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition disabled:opacity-50"
                            >
                              {isSyncing ? 'ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ...' : 'Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑŽ'}
                            </button>
                            <button 
                              onClick={() => setShowSyncModal(false)}
                              className="flex-1 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition"
                            >
                              ÐžÑ‚Ð¼ÐµÐ½Ð°
                            </button>
                          </div>
                        </div>
                      )}
                    </div>
                  </div>
                )}

                {/* ÐœÐ¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Premium */}
                {showPremiumModal && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
                    <div className="bg-gray-800 rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
                      <div className="flex justify-between items-center mb-6">
                        <h3 className="text-white text-2xl font-bold flex items-center">
                          <Crown className="w-8 h-8 mr-3 text-yellow-400" />
                          ChatHub Premium
                        </h3>
                        <button onClick={() => setShowPremiumModal(false)} className="text-gray-400 hover:text-white">
                          <X className="w-6 h-6" />
                        </button>
                      </div>

                      <div className="grid md:grid-cols-2 gap-6 mb-6">
                        <div className="bg-gradient-to-br from-purple-900 to-indigo-800 p-6 rounded-xl">
                          <h4 className="text-white text-xl font-bold mb-4">Ð‘ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ñ‹Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸</h4>
                          <ul className="text-gray-300 space-y-2">
                            <li className="flex items-center">
                              <Check className="w-5 h-5 text-green-400 mr-2" />
                              ÐÐµÐ¾Ð³Ñ€Ð°Ð½Ð¸Ñ‡ÐµÐ½Ð½Ñ‹Ðµ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ
                            </li>
                            <li className="flex items-center">
                              <Check className="w-5 h-5 text-green-400 mr-2" />
                              Ð“Ð¾Ð»Ð¾ÑÐ¾Ð²Ñ‹Ðµ Ð¸ Ð²Ð¸Ð´ÐµÐ¾ Ð·Ð²Ð¾Ð½ÐºÐ¸
                            </li>
                            <li className="flex items-center">
                              <Check className="w-5 h-5 text-green-400 mr-2" />
                              Ð”ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ ÑÐºÑ€Ð°Ð½Ð°
                            </li>
                            <li className="flex items-center">
                              <Check className="w-5 h-5 text-green-400 mr-2" />
                              Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· GitHub
                            </li>
                            <li className="flex items-center">
                              <Check className="w-5 h-5 text-green-400 mr-2" />
                              Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ ÑÐµÑ€Ð²ÐµÑ€Ð¾Ð² Ð¸ ÐºÐ°Ð½Ð°Ð»Ð¾Ð²
                            </li>
                          </ul>
                        </div>

                        <div className="bg-gradient-to-br from-yellow-900 to-orange-800 p-6 rounded-xl border-2 border-yellow-500">
                          <div className="flex items-center mb-4">
                            <Star className="w-6 h-6 text-yellow-400 mr-2" />
                            <h4 className="text-white text-xl font-bold">Premium Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸</h4>
                          </div>
                          <ul className="text-gray-300 space-y-2">
                            {premiumFeatures.map((feature, index) => (
                              <li key={index} className="flex items-center">
                                <Zap className="w-5 h-5 text-yellow-400 mr-2" />
                                {feature}
                              </li>
                            ))}
                          </ul>
                        </div>
                      </div>

                      <div className="grid md:grid-cols-3 gap-4 mb-6">
                        <div className="bg-gray-700 p-4 rounded-lg text-center">
                          <h5 className="text-white font-bold mb-2">1 Ð¼ÐµÑÑÑ†</h5>
                          <div className="text-2xl font-bold text-white mb-2">299 â‚½</div>
                          <div className="text-gray-400 text-sm line-through mb-2">499 â‚½</div>
                          <button 
                            onClick={() => activatePremium(1)}
                            className="w-full py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded transition"
                          >
                            Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ
                          </button>
                        </div>

                        <div className="bg-gradient-to-br from-yellow-600 to-orange-600 p-4 rounded-lg text-center border-2 border-yellow-400 transform scale-105">
                          <div className="premium-badge text-black text-xs font-bold py-1 px-2 rounded-full inline-block mb-2">
                            ÐŸÐžÐŸÐ£Ð›Ð¯Ð ÐÐ«Ð™
                          </div>
                          <h5 className="text-white font-bold mb-2">6 Ð¼ÐµÑÑÑ†ÐµÐ²</h5>
                          <div className="text-2xl font-bold text-white mb-2">1 499 â‚½</div>
                          <div className="text-gray-200 text-sm mb-2">Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ 40%</div>
                          <button 
                            onClick={() => activatePremium(6)}
                            className="w-full py-2 bg-white hover:bg-gray-200 text-black font-bold rounded transition"
                          >
                            Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ
                          </button>
                        </div>

                        <div className="bg-gray-700 p-4 rounded-lg text-center">
                          <h5 className="text-white font-bold mb-2">12 Ð¼ÐµÑÑÑ†ÐµÐ²</h5>
                          <div className="text-2xl font-bold text-white mb-2">2 499 â‚½</div>
                          <div className="text-gray-200 text-sm mb-2">Ð­ÐºÐ¾Ð½Ð¾Ð¼Ð¸Ñ 58%</div>
                          <button 
                            onClick={() => activatePremium(12)}
                            className="w-full py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded transition"
                          >
                            Ð’Ñ‹Ð±Ñ€Ð°Ñ‚ÑŒ
                          </button>
                        </div>
                      </div>

                      <div className="bg-gradient-to-r from-green-900 to-emerald-800 p-4 rounded-lg border border-green-600">
                        <div className="flex items-center mb-2">
                          <Gift className="w-6 h-6 text-green-400 mr-2" />
                          <h4 className="text-white font-bold">ÐŸÐ¾Ð»ÑƒÑ‡Ð¸ Premium Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ð¾!</h4>
                        </div>
                        <p className="text-gray-300 text-sm mb-3">
                          Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐ¹ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ð¾Ð³Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Premium Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼
                        </p>
                        <button 
                          onClick={() => { setShowPromoModal(true); setShowPremiumModal(false); }}
                          className="w-full py-2 bg-green-600 hover:bg-green-700 text-white rounded font-semibold transition"
                        >
                          ÐÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´
                        </button>
                      </div>
                    </div>
                  </div>
                )}

                {/* ÐœÐ¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ð° */}
                {showPromoModal && (
                  <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                    <div className="bg-gray-800 rounded-xl p-6 w-96">
                      <h3 className="text-white text-xl font-bold mb-4 flex items-center">
                        <Gift className="w-6 h-6 mr-2 text-green-400" />
                        ÐÐºÑ‚Ð¸Ð²Ð°Ñ†Ð¸Ñ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ð°
                      </h3>
                      <p className="text-gray-300 mb-4">
                        Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´ Ð´Ð»Ñ Ð¿Ð¾Ð»ÑƒÑ‡ÐµÐ½Ð¸Ñ Ð±ÐµÑÐ¿Ð»Ð°Ñ‚Ð½Ð¾Ð³Ð¾ Ð´Ð¾ÑÑ‚ÑƒÐ¿Ð° Ðº Premium Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼
                      </p>
                      <input 
                        type="text" 
                        value={promoCode}
                        onChange={(e) => setPromoCode(e.target.value)}
                        className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-indigo-500 mb-4" 
                        placeholder="Ð’Ð²ÐµÐ´Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´"
                      />
                      <div className="flex space-x-2">
                        <button 
                          onClick={activateWithPromo}
                          className="flex-1 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition"
                        >
                          ÐÐºÑ‚Ð¸Ð²Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ
                        </button>
                        <button 
                          onClick={() => { setShowPromoModal(false); setShowPremiumModal(true); }}
                          className="flex-1 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition"
                        >
                          ÐÐ°Ð·Ð°Ð´
                        </button>
                      </div>
                      <div className="mt-4 text-xs text-gray-400">
                        <p>ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð¿Ñ€Ð¾Ð¼Ð¾ÐºÐ¾Ð´Ð¾Ð²: FREEMONTH2024, WELCOME50</p>
                      </div>
                    </div>
                  </div>
                )}
              </div>
            );
          }

          if (currentView === 'register') {
            return (
              <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-900 to-pink-800 flex items-center justify-center p-4">
                <div className="bg-gray-900 rounded-2xl shadow-2xl p-8 w-full max-w-md">
                  <div className="text-center mb-8">
                    <div className="inline-flex items-center justify-center w-16 h-16 bg-gradient-to-r from-indigo-500 to-purple-600 rounded-full mb-4">
                      <MessageCircle />
                    </div>
                    <h1 className="text-3xl font-bold text-white mb-2">Ð ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ</h1>
                    <p className="text-gray-400">Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚</p>
                  </div>

                  <form onSubmit={handleRegister} className="space-y-4">
                    <div>
                      <label className="block text-sm font-medium text-gray-300 mb-2">Ð˜Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ</label>
                      <input name="username" type="text" required className="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500 transition" placeholder="Ð’Ð°ÑˆÐµ Ð¸Ð¼Ñ" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-300 mb-2">Email</label>
                      <input name="email" type="email" required className="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500 transition" placeholder="email@example.com" />
                    </div>
                    <div>
                      <label className="block text-sm font-medium text-gray-300 mb-2">ÐŸÐ°Ñ€Ð¾Ð»ÑŒ</label>
                      <input name="password" type="password" required className="w-full px-4 py-3 bg-gray-800 border border-gray-700 rounded-lg text-white focus:outline-none focus:border-indigo-500 transition" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
                    </div>
                    <button type="submit" className="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white rounded-lg font-semibold hover:from-indigo-700 hover:to-purple-700 transition">
                      Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚
                    </button>
                  </form>

                  <div className="mt-6 text-center">
                    <p className="text-gray-400">
                      Ð£Ð¶Ðµ ÐµÑÑ‚ÑŒ Ð°ÐºÐºÐ°ÑƒÐ½Ñ‚?{' '}
                      <button onClick={() => setCurrentView('login')} className="text-indigo-400 hover:text-indigo-300 font-semibold">
                        Ð’Ð¾Ð¹Ñ‚Ð¸
                      </button>
                    </p>
                  </div>

                  <div className="mt-4 text-center">
                    <button 
                      onClick={() => setShowSyncModal(true)}
                      className="text-gray-400 hover:text-white text-sm flex items-center justify-center space-x-2 mx-auto"
                    >
                      <Github className="w-4 h-4" />
                      <span>ÐÐ°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑŽ Ñ GitHub</span>
                    </button>
                  </div>

                  {/* ÐšÐ½Ð¾Ð¿ÐºÐ° Premium Ð² Ñ„Ð¾Ñ€Ð¼Ðµ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ */}
                  <div className="mt-6 text-center">
                    <button 
                      onClick={() => setShowPremiumModal(true)}
                      className="w-full py-3 premium-badge text-black font-bold rounded-lg flex items-center justify-center space-x-2"
                    >
                      <Crown className="w-5 h-5" />
                      <span>ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Premium ÑÐ¾ ÑÐºÐ¸Ð´ÐºÐ¾Ð¹</span>
                    </button>
                  </div>
                </div>
              </div>
            );
          }

          const currentMessages = selectedChannel 
            ? messages[`${selectedServer?.id}-${selectedChannel.id}`] || []
            : selectedDM
            ? dmMessages[[currentUser.username, selectedDM].sort().join('-')] || []
            : [];

          return (
            <div className="h-screen bg-gray-900 flex overflow-hidden">
              {/* Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ */}
              <div className="fixed top-4 right-4 z-50 space-y-2 max-w-sm">
                {notifications.map(notification => (
                  <div key={notification.id} className={`notification p-4 rounded-lg shadow-lg border-l-4 ${
                    notification.type === 'success' ? 'bg-green-900 border-green-500 text-green-200' :
                    notification.type === 'error' ? 'bg-red-900 border-red-500 text-red-200' :
                    'bg-blue-900 border-blue-500 text-blue-200'
                  }`}>
                    <div className="flex items-center">
                      <Bell className="w-5 h-5 mr-2" />
                      <span>{notification.message}</span>
                    </div>
                  </div>
                ))}
              </div>

              {/* ÐœÐ¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ GitHub */}
              {showSyncModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                  <div className="bg-gray-800 rounded-xl p-6 w-96">
                    <h3 className="text-white text-xl font-bold mb-4 flex items-center">
                      <Github className="w-6 h-6 mr-2" />
                      Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ GitHub
                    </h3>
                    
                    {syncEnabled ? (
                      <div className="space-y-4">
                        <div className="bg-green-900 bg-opacity-30 p-3 rounded-lg border border-green-700">
                          <div className="flex items-center">
                            <Cloud className="w-5 h-5 text-green-400 mr-2" />
                            <span className="text-green-400 font-semibold">Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°</span>
                          </div>
                          <p className="text-gray-300 text-sm mt-2">
                            Ð’Ð°ÑˆÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ðµ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€ÑƒÑŽÑ‚ÑÑ
                          </p>
                          {lastSyncTime && (
                            <p className="text-gray-400 text-xs mt-1">
                              ÐŸÐ¾ÑÐ»ÐµÐ´Ð½ÑÑ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ: {lastSyncTime}
                            </p>
                          )}
                        </div>
                        <div className="flex space-x-2">
                          <button 
                            onClick={syncWithGitHub}
                            disabled={isSyncing}
                            className="flex-1 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition disabled:opacity-50 flex items-center justify-center space-x-2"
                          >
                            <RefreshCw className={`w-4 h-4 ${isSyncing ? 'animate-spin' : ''}`} />
                            <span>{isSyncing ? 'Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ...' : 'Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð¸Ñ€Ð¾Ð²Ð°Ñ‚ÑŒ'}</span>
                          </button>
                          <button 
                            onClick={pushToGitHub}
                            disabled={isSyncing}
                            className="flex-1 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition disabled:opacity-50"
                          >
                            ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð´Ð°Ð½Ð½Ñ‹Ðµ
                          </button>
                        </div>
                        <button 
                          onClick={disableSync}
                          className="w-full py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg transition"
                        >
                          ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑŽ
                        </button>
                        <button 
                          onClick={() => setShowSyncModal(false)}
                          className="w-full py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition"
                        >
                          Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ
                        </button>
                      </div>
                    ) : (
                      <div className="space-y-4">
                        <p className="text-gray-300">
                          Ð”Ð»Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ð¸ Ð¼ÐµÐ¶Ð´Ñƒ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°Ð¼Ð¸ Ð½ÑƒÐ¶ÐµÐ½ GitHub Personal Access Token.
                        </p>
                        
                        <ol className="text-gray-300 text-sm space-y-2 list-decimal list-inside">
                          <li>ÐŸÐµÑ€ÐµÐ¹Ð´Ð¸Ñ‚Ðµ Ð² <a href="https://github.com/settings/tokens" target="_blank" className="text-indigo-400 hover:underline">GitHub Settings â†’ Developer settings â†’ Personal access tokens</a></li>
                          <li>ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ "Generate new token"</li>
                          <li>Ð”Ð°Ð¹Ñ‚Ðµ Ð¸Ð¼Ñ Ñ‚Ð¾ÐºÐµÐ½Ñƒ (Ð½Ð°Ð¿Ñ€Ð¸Ð¼ÐµÑ€ "ChatHub")</li>
                          <li>Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÑ€Ð¾Ðº Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ (Ñ€ÐµÐºÐ¾Ð¼ÐµÐ½Ð´ÑƒÐµÑ‚ÑÑ "No expiration")</li>
                          <li>ÐžÑ‚Ð¼ÐµÑ‚ÑŒÑ‚Ðµ Ð³Ð°Ð»Ð¾Ñ‡ÐºÑƒ "gist" (Create gists)</li>
                          <li>ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ "Generate token" Ð¸ ÑÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ‚Ð¾ÐºÐµÐ½</li>
                          <li>Ð’ÑÑ‚Ð°Ð²ÑŒÑ‚Ðµ Ñ‚Ð¾ÐºÐµÐ½ Ð½Ð¸Ð¶Ðµ:</li>
                        </ol>
                        
                        <div>
                          <input 
                            type="text" 
                            value={syncToken}
                            onChange={(e) => setSyncToken(e.target.value)}
                            className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-indigo-500" 
                            placeholder="ghp_xxxxxxxxxxxxxxxxxxxx"
                          />
                        </div>
                        
                        <div className="flex space-x-2">
                          <button 
                            onClick={() => enableSync(syncToken)}
                            disabled={isSyncing}
                            className="flex-1 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg transition disabled:opacity-50"
                          >
                            {isSyncing ? 'ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ...' : 'Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑŽ'}
                          </button>
                          <button 
                            onClick={() => setShowSyncModal(false)}
                            className="flex-1 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition"
                          >
                            ÐžÑ‚Ð¼ÐµÐ½Ð°
                          </button>
                        </div>
                      </div>
                    )}
                  </div>
                </div>
              )}

              {/* ÐœÐ¾Ð´Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¾ÐºÐ½Ð¾ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ */}
              {showProfileSettings && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                  <div className="bg-gray-800 rounded-xl p-6 w-96">
                    <h3 className="text-white text-xl font-bold mb-4">ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ</h3>
                    <div className="space-y-4">
                      <div>
                        <label className="block text-sm font-medium text-gray-300 mb-2">ÐÐ²Ð°Ñ‚Ð°Ñ€ (URL)</label>
                        <input 
                          type="text" 
                          value={profileData.avatar} 
                          onChange={(e) => setProfileData({...profileData, avatar: e.target.value})}
                          className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-indigo-500" 
                          placeholder="https://example.com/avatar.jpg" 
                        />
                      </div>
                      <div>
                        <label className="block text-sm font-medium text-gray-300 mb-2">Ð¡Ñ‚Ð°Ñ‚ÑƒÑ</label>
                        <select 
                          value={profileData.status} 
                          onChange={(e) => setProfileData({...profileData, status: e.target.value})}
                          className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-indigo-500"
                        >
                          <option value="online">Ð’ ÑÐµÑ‚Ð¸</option>
                          <option value="idle">ÐÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½</option>
                          <option value="dnd">ÐÐµ Ð±ÐµÑÐ¿Ð¾ÐºÐ¾Ð¸Ñ‚ÑŒ</option>
                          <option value="offline">ÐÐµ Ð² ÑÐµÑ‚Ð¸</option>
                        </select>
                      </div>
                      
                      {/* Ð¡ÐµÐºÑ†Ð¸Ñ Premium Ð² Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ°Ñ… Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ */}
                      <div className="border-t border-gray-700 pt-4 mt-4">
                        <h4 className="text-white font-semibold mb-2 flex items-center">
                          <Crown className="w-5 h-5 mr-2 text-yellow-400" />
                          ÐŸÑ€ÐµÐ¼Ð¸ÑƒÐ¼ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ°
                        </h4>
                        {hasPremium ? (
                          <div className="bg-gradient-to-r from-yellow-900 to-orange-800 p-3 rounded-lg border border-yellow-600">
                            <div className="flex items-center">
                              <Star className="w-5 h-5 text-yellow-400 mr-2" />
                              <span className="text-white font-semibold">Premium Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½</span>
                            </div>
                            <p className="text-gray-300 text-sm mt-1">
                              Ð’Ñ‹ Ð½Ð°ÑÐ»Ð°Ð¶Ð´Ð°ÐµÑ‚ÐµÑÑŒ Ð²ÑÐµÐ¼Ð¸ Ð¿Ñ€ÐµÐ¼Ð¸ÑƒÐ¼ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑÐ¼Ð¸!
                            </p>
                          </div>
                        ) : (
                          <div className="bg-gray-700 p-3 rounded-lg">
                            <p className="text-gray-300 text-sm mb-2">
                              ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ Ð²ÑÐµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸ ChatHub Ñ Premium Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¾Ð¹
                            </p>
                            <button 
                              onClick={() => { setShowProfileSettings(false); setShowPremiumModal(true); }}
                              className="w-full py-2 premium-badge text-black font-bold rounded transition"
                            >
                              ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Premium
                            </button>
                          </div>
                        )}
                      </div>
                      
                      <div className="flex space-x-2">
                        <button onClick={updateProfile} className="flex-1 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition">
                          Ð¡Ð¾Ñ…Ñ€Ð°Ð½Ð¸Ñ‚ÑŒ
                        </button>
                        <button onClick={() => setShowProfileSettings(false)} className="flex-1 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition">
                          ÐžÑ‚Ð¼ÐµÐ½Ð°
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              )}

              {showInviteModal && (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
                  <div className="bg-gray-800 rounded-xl p-6 w-96">
                    <h3 className="text-white text-xl font-bold mb-4">ÐŸÑ€Ð¸Ð³Ð»Ð°ÑÐ¸Ñ‚ÑŒ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€</h3>
                    <div className="bg-gray-900 p-3 rounded-lg mb-4 flex items-center justify-between">
                      <span className="text-gray-300 text-sm truncate flex-1">{inviteLink}</span>
                      <button onClick={copyInviteLink} className="ml-2 p-2 bg-indigo-600 hover:bg-indigo-700 rounded transition">
                        <Copy />
                      </button>
                    </div>
                    <div className="mb-4">
                      <p className="text-gray-300 text-sm mb-2">Ð˜Ð»Ð¸ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ Ð¿Ñ€Ð¸Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ðµ Ð´Ñ€ÑƒÐ³Ñƒ:</p>
                      <select 
                        onChange={(e) => e.target.value && sendDirectInvite(e.target.value)}
                        className="w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-lg text-white focus:outline-none focus:border-indigo-500"
                      >
                        <option value="">Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð´Ñ€ÑƒÐ³Ð°</option>
                        {friends.map(friend => (
                          <option key={friend} value={friend}>{friend}</option>
                        ))}
                      </select>
                    </div>
                    <button onClick={() => setShowInviteModal(false)} className="w-full py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition">
                      Ð—Ð°ÐºÑ€Ñ‹Ñ‚ÑŒ
                    </button>
                  </div>
                </div>
              )}

              {/* ÐšÐ½Ð¾Ð¿ÐºÐ° ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÐµÐ¹ */}
              {currentView === 'app' && (
                <div className="fixed bottom-4 left-4 z-40 flex flex-col space-y-2">
                  <button 
                    onClick={() => setShowSyncModal(true)}
                    className={`p-3 rounded-full shadow-lg ${
                      syncEnabled 
                        ? 'bg-green-600 hover:bg-green-700' 
                        : 'bg-gray-700 hover:bg-gray-600'
                    } transition relative`}
                    title={syncEnabled ? 'Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ð²ÐºÐ»ÑŽÑ‡ÐµÐ½Ð°' : 'ÐÐ°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ÑŒ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸ÑŽ'}
                  >
                    {syncEnabled ? (
                      <>
                        <Cloud className="w-6 h-6" />
                        {isSyncing && (
                          <div className="absolute -top-1 -right-1">
                            <div className="pulse-sync w-3 h-3 bg-blue-500 rounded-full"></div>
                          </div>
                        )}
                      </>
                    ) : (
                      <Github className="w-6 h-6" />
                    )}
                  </button>
                  
                  {syncEnabled && lastSyncTime && (
                    <div className="bg-gray-800 bg-opacity-80 rounded-lg px-2 py-1 text-xs text-gray-300 max-w-24 text-center">
                      {lastSyncTime}
                    </div>
                  )}
                </div>
              )}

              {/* ÐšÐ½Ð¾Ð¿ÐºÐ° Premium Ð² Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐµ */}
              {currentView === 'app' && !hasPremium && (
                <div className="fixed bottom-4 right-4 z-40">
                  <button 
                    onClick={() => setShowPremiumModal(true)}
                    className="premium-badge p-3 rounded-full shadow-lg transition transform hover:scale-105"
                    title="ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Premium"
                  >
                    <Crown className="w-6 h-6" />
                  </button>
                </div>
              )}

              {/* Ð‘ÐµÐ¹Ð´Ð¶ Premium Ð´Ð»Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹ Ñ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ¾Ð¹ */}
              {currentView === 'app' && hasPremium && (
                <div className="fixed top-4 left-4 z-40">
                  <div className="premium-badge px-3 py-1 rounded-full text-black font-bold text-sm flex items-center space-x-1">
                    <Crown className="w-4 h-4" />
                    <span>PREMIUM</span>
                  </div>
                </div>
              )}

              <div className="w-20 bg-gray-950 flex flex-col items-center py-4 space-y-3">
                <button onClick={() => { setSelectedServer(null); setSelectedChannel(null); setSelectedDM(null); }} className="w-14 h-14 bg-gradient-to-br from-indigo-600 to-purple-600 rounded-2xl flex items-center justify-center hover:rounded-xl transition-all duration-200">
                  <Users />
                </button>
                
                <div className="w-10 h-0.5 bg-gray-800 rounded-full" />

                {servers.map(server => (
                  <button key={server.id} onClick={() => { setSelectedServer(server); setSelectedChannel(server.channels[0]); setSelectedDM(null); }} className={`w-14 h-14 ${selectedServer?.id === server.id ? 'bg-indigo-600 rounded-xl' : 'bg-gray-800 rounded-3xl hover:rounded-xl hover:bg-indigo-700'} flex items-center justify-center text-white font-bold transition-all duration-200`}>
                    {server.name[0].toUpperCase()}
                  </button>
                ))}

                <button onClick={createServer} className="w-14 h-14 bg-gray-800 rounded-3xl hover:rounded-xl hover:bg-green-600 flex items-center justify-center transition-all duration-200">
                  <Plus className="text-green-500" />
                </button>
              </div>

              {selectedServer ? (
                <div className="w-60 bg-gray-800 flex flex-col">
                  <div className="h-14 px-4 flex items-center justify-between border-b border-gray-900 shadow-lg">
                    <h2 className="text-white font-bold truncate">{selectedServer.name}</h2>
                    {selectedServer.owner === currentUser.username && (
                      <button onClick={() => setShowChannelSettings(!showChannelSettings)} className="p-1 hover:bg-gray-700 rounded transition">
                        <Settings className="w-5 h-5 text-gray-400" />
                      </button>
                    )}
                  </div>

                  {showChannelSettings && selectedServer.owner === currentUser.username && (
                    <div className="p-3 bg-gray-750 border-b border-gray-900">
                      <p className="text-gray-400 text-xs font-semibold uppercase mb-2">Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ</p>
                      <div className="space-y-1">
                        <button onClick={() => createChannel('text')} className="w-full px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded transition flex items-center space-x-2">
                          <Hash className="w-4 h-4" />
                          <span>Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ð¹</span>
                        </button>
                        <button onClick={() => createChannel('voice')} className="w-full px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded transition flex items-center space-x-2">
                          <Volume2 className="w-4 h-4" />
                          <span>Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ð³Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð¹</span>
                        </button>
                        <button onClick={() => createChannel('stage')} className="w-full px-3 py-2 bg-gray-700 hover:bg-gray-600 text-white text-sm rounded transition flex items-center space-x-2">
                          <Monitor className="w-4 h-4" />
                          <span>Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ Ñ‚Ñ€Ð¸Ð±ÑƒÐ½Ñƒ</span>
                        </button>
                        <button onClick={generateInvite} className="w-full px-3 py-2 bg-indigo-600 hover:bg-indigo-700 text-white text-sm rounded transition flex items-center space-x-2">
                          <UserPlus className="w-4 h-4" />
                          <span>ÐŸÑ€Ð¸Ð³Ð»Ð°ÑÐ¸Ñ‚ÑŒ Ð»ÑŽÐ´ÐµÐ¹</span>
                        </button>
                      </div>
                    </div>
                  )}
                  
                  <div className="flex-1 overflow-y-auto p-3 space-y-1">
                    {selectedServer.channels.map(channel => (
                      <div key={channel.id} className="flex items-center group">
                        <button onClick={() => setSelectedChannel(channel)} className={`flex-1 px-3 py-2 rounded-lg flex items-center space-x-3 ${selectedChannel?.id === channel.id ? 'bg-gray-700 text-white' : 'text-gray-400 hover:bg-gray-700 hover:text-gray-200'} transition`}>
                          {channel.type === 'text' && <Hash className="w-5 h-5" />}
                          {channel.type === 'voice' && <Volume2 className="w-5 h-5" />}
                          {channel.type === 'stage' && <Monitor className="w-5 h-5" />}
                          <span className="font-medium truncate">{channel.name}</span>
                          {activeVoiceChannels[`${selectedServer.id}-${channel.id}`] && channel.type === 'voice' && (
                            <span className="text-green-500 text-xs font-bold">
                              {activeVoiceChannels[`${selectedServer.id}-${channel.id}`].length}
                            </span>
                          )}
                        </button>
                        {selectedServer.owner === currentUser.username && showChannelSettings && (
                          <button onClick={() => deleteChannel(channel.id)} className="opacity-0 group-hover:opacity-100 p-1 hover:bg-red-600 rounded transition">
                            <Trash2 className="w-4 h-4 text-gray-400 hover:text-white" />
                          </button>
                        )}
                      </div>
                    ))}
                  </div>

                  <div className="p-3 bg-gray-900 border-t border-gray-950">
                    <div className="flex items-center space-x-3 px-2 py-2 bg-gray-800 rounded-lg">
                      <div 
                        className="w-9 h-9 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-sm cursor-pointer relative"
                        onClick={() => setShowProfileSettings(true)}
                      >
                        {profileData.avatar ? (
                          <img src={profileData.avatar} alt="Avatar" className="w-full h-full rounded-full" />
                        ) : (
                          currentUser.username[0].toUpperCase()
                        )}
                        {hasPremium && (
                          <div className="absolute -top-1 -right-1 bg-yellow-500 rounded-full w-3 h-3"></div>
                        )}
                      </div>
                      <div className="flex-1 min-w-0">
                        <p className="text-white text-sm font-semibold truncate">{currentUser.username}</p>
                        <p className={`text-xs ${
                          profileData.status === 'online' ? 'text-green-500' :
                          profileData.status === 'idle' ? 'text-yellow-500' :
                          profileData.status === 'dnd' ? 'text-red-500' :
                          'text-gray-500'
                        }`}>
                          {profileData.status === 'online' ? 'Ð’ ÑÐµÑ‚Ð¸' :
                           profileData.status === 'idle' ? 'ÐÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½' :
                           profileData.status === 'dnd' ? 'ÐÐµ Ð±ÐµÑÐ¿Ð¾ÐºÐ¾Ð¸Ñ‚ÑŒ' :
                           'ÐÐµ Ð² ÑÐµÑ‚Ð¸'}
                        </p>
                      </div>
                      <button onClick={() => setShowProfileSettings(true)} className="p-1.5 hover:bg-gray-700 rounded transition" title="ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸">
                        <Settings className="w-4 h-4 text-gray-400 hover:text-white" />
                      </button>
                      <button onClick={handleLogout} className="p-1.5 hover:bg-gray-700 rounded transition" title="Ð’Ñ‹Ð¹Ñ‚Ð¸">
                        <LogOut className="w-4 h-4 text-gray-400 hover:text-white" />
                      </button>
                    </div>
                  </div>
                </div>
              ) : (
                <div className="w-60 bg-gray-800 flex flex-col">
                  <div className="h-14 px-4 flex items-center border-b border-gray-900 shadow-lg">
                    <h2 className="text-white font-bold">Ð›Ð¸Ñ‡Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ</h2>
                  </div>
                  
                  <div className="p-4 border-b border-gray-700">
                    <div className="flex space-x-2">
                      <input type="text" value={searchUser} onChange={(e) => setSearchUser(e.target.value)} placeholder="Ð˜Ð¼Ñ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ" className="flex-1 px-3 py-2 bg-gray-900 border border-gray-700 rounded-lg text-white text-sm focus:outline-none focus:border-indigo-500" />
                      <button onClick={sendFriendRequest} className="p-2 bg-indigo-600 hover:bg-indigo-700 rounded-lg transition">
                        <UserPlus />
                      </button>
                    </div>
                  </div>

                  {friendRequests.length > 0 && (
                    <div className="p-3 border-b border-gray-700">
                      <h3 className="text-gray-400 text-xs font-semibold uppercase mb-2">Ð—Ð°Ð¿Ñ€Ð¾ÑÑ‹ Ð² Ð´Ñ€ÑƒÐ·ÑŒÑ</h3>
                      {friendRequests.map(username => (
                        <div key={username} className="flex items-center justify-between p-2 bg-gray-900 rounded-lg mb-2">
                          <span className="text-white text-sm">{username}</span>
                          <div className="flex space-x-1">
                            <button onClick={() => acceptFriendRequest(username)} className="p-1.5 bg-green-600 hover:bg-green-700 rounded transition">
                              <Check />
                            </button>
                            <button onClick={() => declineFriendRequest(username)} className="p-1.5 bg-red-600 hover:bg-red-700 rounded transition">
                              <X />
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  )}

                  <div className="flex-1 overflow-y-auto p-3">
                    <h3 className="text-gray-400 text-xs font-semibold uppercase mb-2">Ð’ÑÐµ Ð´Ñ€ÑƒÐ·ÑŒÑ â€” {friends.length}</h3>
                    {friends.map(friend => (
                      <div key={friend} className="group">
                        <button onClick={() => openDM(friend)} className={`w-full flex items-center space-x-3 p-2 rounded-lg transition mb-1 ${selectedDM === friend ? 'bg-gray-700' : 'hover:bg-gray-700'}`}>
                          <div className="w-9 h-9 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center text-white font-bold text-sm">
                            {friend[0].toUpperCase()}
                          </div>
                          <div className="flex-1 text-left">
                            <p className="text-white text-sm font-medium">{friend}</p>
                            <p className="text-green-500 text-xs">Ð’ ÑÐµÑ‚Ð¸</p>
                          </div>
                          <Mail className="w-4 h-4 text-gray-400 group-hover:text-white" />
                        </button>
                      </div>
                    ))}
                  </div>

                  <div className="p-3 bg-gray-900 border-t border-gray-950">
                    <div className="flex items-center space-x-3 px-2 py-2 bg-gray-800 rounded-lg">
                      <div 
                        className="w-9 h-9 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold text-sm cursor-pointer relative"
                        onClick={() => setShowProfileSettings(true)}
                      >
                        {profileData.avatar ? (
                          <img src={profileData.avatar} alt="Avatar" className="w-full h-full rounded-full" />
                        ) : (
                          currentUser.username[0].toUpperCase()
                        )}
                        {hasPremium && (
                          <div className="absolute -top-1 -right-1 bg-yellow-500 rounded-full w-3 h-3"></div>
                        )}
                      </div>
                      <div className="flex-1 min-w-0">
                        <p className="text-white text-sm font-semibold truncate">{currentUser.username}</p>
                        <p className={`text-xs ${
                          profileData.status === 'online' ? 'text-green-500' :
                          profileData.status === 'idle' ? 'text-yellow-500' :
                          profileData.status === 'dnd' ? 'text-red-500' :
                          'text-gray-500'
                        }`}>
                          {profileData.status === 'online' ? 'Ð’ ÑÐµÑ‚Ð¸' :
                           profileData.status === 'idle' ? 'ÐÐµÐ°ÐºÑ‚Ð¸Ð²ÐµÐ½' :
                           profileData.status === 'dnd' ? 'ÐÐµ Ð±ÐµÑÐ¿Ð¾ÐºÐ¾Ð¸Ñ‚ÑŒ' :
                           'ÐÐµ Ð² ÑÐµÑ‚Ð¸'}
                        </p>
                      </div>
                      <button onClick={() => setShowProfileSettings(true)} className="p-1.5 hover:bg-gray-700 rounded transition" title="ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸">
                        <Settings className="w-4 h-4 text-gray-400 hover:text-white" />
                      </button>
                      <button onClick={handleLogout} className="p-1.5 hover:bg-gray-700 rounded transition" title="Ð’Ñ‹Ð¹Ñ‚Ð¸">
                        <LogOut className="w-4 h-4 text-gray-400 hover:text-white" />
                      </button>
                    </div>
                  </div>
                </div>
              )}

              <div className="flex-1 flex flex-col">
                {selectedChannel || selectedDM ? (
                  <>
                    <div className="h-14 px-5 flex items-center justify-between border-b border-gray-800 bg-gray-800 shadow-md">
                      <div className="flex items-center space-x-3">
                        {selectedChannel && selectedChannel.type === 'text' && <Hash className="w-6 h-6 text-gray-400" />}
                        {selectedChannel && selectedChannel.type === 'voice' && <Volume2 className="w-6 h-6 text-gray-400" />}
                        {selectedChannel && selectedChannel.type === 'stage' && <Monitor className="w-6 h-6 text-gray-400" />}
                        {selectedDM && <Mail className="w-6 h-6 text-gray-400" />}
                        <h3 className="text-white font-semibold">
                          {selectedChannel ? selectedChannel.name : `@${selectedDM}`}
                        </h3>
                        {selectedChannel && selectedChannel.type === 'voice' && activeVoiceChannels[`${selectedServer.id}-${selectedChannel.id}`] && (
                          <span className="text-green-500 text-sm">
                            {activeVoiceChannels[`${selectedServer.id}-${selectedChannel.id}`].length} ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð²
                          </span>
                        )}
                      </div>
                    </div>

                    {selectedChannel && (selectedChannel.type === 'voice' || selectedChannel.type === 'stage') ? (
                      <div className="flex-1 flex flex-col bg-gray-850">
                        <div className="flex-1 flex items-center justify-center p-8">
                          <div className="text-center max-w-4xl w-full">
                            {!inVoiceChat ? (
                              <>
                                <div className="w-32 h-32 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-6">
                                  {selectedChannel.type === 'voice' ? <Volume2 className="w-16 h-16" /> : <Monitor className="w-16 h-16" />}
                                </div>
                                <h3 className="text-white text-2xl font-bold mb-3">{selectedChannel.name}</h3>
                                <p className="text-gray-400 mb-6">{selectedChannel.type === 'voice' ? 'Ð“Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð¹ ÐºÐ°Ð½Ð°Ð» Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹ Ð²Ð¸Ð´ÐµÐ¾ Ð¸ Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸ ÑÐºÑ€Ð°Ð½Ð°' : 'Ð¢Ñ€Ð¸Ð±ÑƒÐ½Ð° - Ð²Ñ‹ÑÑ‚ÑƒÐ¿Ð°Ð¹Ñ‚Ðµ Ð¿ÐµÑ€ÐµÐ´ Ð°ÑƒÐ´Ð¸Ñ‚Ð¾Ñ€Ð¸ÐµÐ¹'}</p>
                                <button onClick={joinVoiceChannel} className="px-8 py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-semibold transition flex items-center space-x-2 mx-auto">
                                  <Phone />
                                  <span>ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ</span>
                                </button>
                                
                                {activeVoiceChannels[`${selectedServer.id}-${selectedChannel.id}`] && (
                                  <div className="mt-8">
                                    <h4 className="text-white text-lg font-semibold mb-4">Ð£Ñ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¸ Ð² ÐºÐ°Ð½Ð°Ð»Ðµ:</h4>
                                    <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
                                      {activeVoiceChannels[`${selectedServer.id}-${selectedChannel.id}`].map((user, idx) => (
                                        <div key={idx} className="bg-gray-800 rounded-lg p-3 flex items-center space-x-3">
                                          <div className="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold">
                                            {user[0].toUpperCase()}
                                          </div>
                                          <span className="text-white text-sm font-medium">{user}</span>
                                        </div>
                                      ))}
                                    </div>
                                  </div>
                                )}
                              </>
                            ) : (
                              <>
                                <div className="mb-6">
                                  <div className="flex items-center justify-center space-x-4 mb-6 flex-wrap">
                                    {(isVideoOn || isScreenSharing) && (
                                      <div className="relative mb-4">
                                        <video 
                                          ref={localVideoRef} 
                                          autoPlay 
                                          muted 
                                          playsInline 
                                          className="w-64 h-48 bg-gray-900 rounded-lg" 
                                        />
                                        <div className="absolute bottom-2 left-2 bg-black bg-opacity-70 px-2 py-1 rounded text-white text-sm">
                                          {currentUser.username} {isScreenSharing ? '(Ð”ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ ÑÐºÑ€Ð°Ð½Ð°)' : ''}
                                        </div>
                                      </div>
                                    )}
                                    
                                    {!isVideoOn && !isScreenSharing && (
                                      <div className="w-32 h-32 bg-gradient-to-br from-green-500 to-teal-600 rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse">
                                        <Volume2 className="w-16 h-16" />
                                      </div>
                                    )}
                                  </div>

                                  <h3 className="text-white text-2xl font-bold mb-3">{selectedChannel.type === 'voice' ? 'Ð“Ð¾Ð»Ð¾ÑÐ¾Ð²Ð¾Ð¹ Ñ‡Ð°Ñ‚ Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½' : 'Ð¢Ñ€Ð¸Ð±ÑƒÐ½Ð° Ð°ÐºÑ‚Ð¸Ð²Ð½Ð°'}</h3>
                                  <p className="text-green-400 mb-6">Ð’Ñ‹ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ñ‹ Ðº ÐºÐ°Ð½Ð°Ð»Ñƒ</p>
                                </div>

                                {renderVoiceChannelParticipants()}

                                <div className="flex items-center justify-center space-x-3 mt-8">
                                  <button onClick={toggleMute} className={`p-4 rounded-full transition ${isMuted ? 'bg-red-600 hover:bg-red-700' : 'bg-gray-700 hover:bg-gray-600'}`} title={isMuted ? 'Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½' : 'Ð’Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ Ð¼Ð¸ÐºÑ€Ð¾Ñ„Ð¾Ð½'}>
                                    {isMuted ? <MicOff /> : <Mic />}
                                  </button>
                                  <button onClick={toggleVideo} className={`p-4 rounded-full transition ${isVideoOn ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-700 hover:bg-gray-600'}`} title={isVideoOn ? 'Ð’Ñ‹ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÐºÐ°Ð¼ÐµÑ€Ñƒ' : 'Ð’ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒ ÐºÐ°Ð¼ÐµÑ€Ñƒ'}>
                                    {isVideoOn ? <Video /> : <VideoOff />}
                                  </button>
                                  <button onClick={toggleScreenShare} className={`p-4 rounded-full transition ${isScreenSharing ? 'bg-green-600 hover:bg-green-700' : 'bg-gray-700 hover:bg-gray-600'}`} title={isScreenSharing ? 'ÐžÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸ÑŽ' : 'Ð”ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸Ñ ÑÐºÑ€Ð°Ð½Ð°'}>
                                    {isScreenSharing ? <MonitorOff /> : <Monitor />}
                                  </button>
                                  <button onClick={leaveVoiceChannel} className="p-4 bg-red-600 hover:bg-red-700 rounded-full transition" title="ÐžÑ‚ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ">
                                    <PhoneOff />
                                  </button>
                                </div>
                              </>
                            )}
                          </div>
                        </div>
                      </div>
                    ) : (
                      <>
                        <div className="flex-1 overflow-y-auto p-4 space-y-4 bg-gray-850">
                          {currentMessages.length === 0 ? (
                            <div className="text-center text-gray-500 mt-10">
                              {selectedChannel ? (
                                <>
                                  <Hash className="w-16 h-16 mx-auto mb-4 opacity-50" />
                                  <p className="text-lg font-semibold">Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² #{selectedChannel.name}!</p>
                                  <p className="text-sm mt-2">Ð­Ñ‚Ð¾ Ð½Ð°Ñ‡Ð°Ð»Ð¾ ÐºÐ°Ð½Ð°Ð»Ð°. ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð¿ÐµÑ€Ð²Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ!</p>
                                </>
                              ) : (
                                <>
                                  <Mail className="w-16 h-16 mx-auto mb-4 opacity-50" />
                                  <p className="text-lg font-semibold">ÐÐ°Ñ‡Ð°Ð»Ð¾ Ð¿ÐµÑ€ÐµÐ¿Ð¸ÑÐºÐ¸ Ñ @{selectedDM}</p>
                                  <p className="text-sm mt-2">ÐžÑ‚Ð¿Ñ€Ð°Ð²ÑŒÑ‚Ðµ Ð¿ÐµÑ€Ð²Ð¾Ðµ Ð»Ð¸Ñ‡Ð½Ð¾Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ!</p>
                                </>
                              )}
                            </div>
                          ) : (
                            currentMessages.map(msg => (
                              <div key={msg.id} className="flex space-x-3 hover:bg-gray-800 p-2 rounded transition">
                                <div className="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-full flex items-center justify-center text-white font-bold flex-shrink-0">
                                  {msg.author[0].toUpperCase()}
                                </div>
                                <div className="flex-1 min-w-0">
                                  <div className="flex items-baseline space-x-2">
                                    <span className="text-white font-semibold">{msg.author}</span>
                                    <span className="text-gray-500 text-xs">{msg.timestamp}</span>
                                  </div>
                                  {msg.type === 'invite' ? (
                                    <div className="bg-gray-800 p-3 rounded-lg mt-2 border border-indigo-700">
                                      <p className="text-white font-semibold">ÐŸÑ€Ð¸Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ðµ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€</p>
                                      <p className="text-gray-300 text-sm mt-1">ÐŸÑ€Ð¸ÑÐ¾ÐµÐ´Ð¸Ð½Ð¸Ñ‚ÑŒÑÑ Ðº "{msg.serverName}"</p>
                                      <button 
                                        onClick={() => handleInviteAccept(msg.serverId, msg.serverName)}
                                        className="mt-2 px-4 py-1 bg-indigo-600 hover:bg-indigo-700 text-white rounded text-sm transition"
                                      >
                                        ÐŸÑ€Ð¸Ð½ÑÑ‚ÑŒ Ð¿Ñ€Ð¸Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ðµ
                                      </button>
                                    </div>
                                  ) : (
                                    <p className="text-gray-300 break-words">{msg.content}</p>
                                  )}
                                </div>
                              </div>
                            ))
                          )}
                          <div ref={messagesEndRef} />
                        </div>

                        <div className="p-4 bg-gray-800 border-t border-gray-700">
                          <div className="flex space-x-3">
                            <input type="text" value={messageInput} onChange={(e) => setMessageInput(e.target.value)} onKeyPress={(e) => e.key === 'Enter' && sendMessage()} placeholder={selectedChannel ? `Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ Ð² #${selectedChannel.name}` : `Ð¡Ð¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ðµ @${selectedDM}`} className="flex-1 px-4 py-3 bg-gray-700 text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500" />
                            <button onClick={sendMessage} className="px-6 py-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg font-semibold transition flex items-center space-x-2">
                              <Send />
                              <span>ÐžÑ‚Ð¿Ñ€Ð°Ð²Ð¸Ñ‚ÑŒ</span>
                            </button>
                          </div>
                        </div>
                      </>
                    )}
                  </>
                ) : (
                  <div className="flex-1 flex items-center justify-center bg-gray-850">
                    <div className="text-center">
                      <Users className="w-24 h-24 text-gray-700 mx-auto mb-6" />
                      <h2 className="text-2xl font-bold text-white mb-3">Ð”Ð¾Ð±Ñ€Ð¾ Ð¿Ð¾Ð¶Ð°Ð»Ð¾Ð²Ð°Ñ‚ÑŒ Ð² ChatHub Online!</h2>
                      <p className="text-gray-400 mb-6 max-w-md">
                        ðŸŽ¤ Ð“Ð¾Ð»Ð¾ÑÐ¾Ð²Ñ‹Ðµ Ñ‡Ð°Ñ‚Ñ‹ Ñ Ð²Ð¸Ð´ÐµÐ¾ Ð¸ Ð´ÐµÐ¼Ð¾Ð½ÑÑ‚Ñ€Ð°Ñ†Ð¸ÐµÐ¹ ÑÐºÑ€Ð°Ð½Ð°<br />
                        ðŸ’¬ Ð›Ð¸Ñ‡Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ Ð¸ Ñ‚ÐµÐºÑÑ‚Ð¾Ð²Ñ‹Ðµ ÐºÐ°Ð½Ð°Ð»Ñ‹<br />
                        ðŸŽ­ Ð¢Ñ€Ð¸Ð±ÑƒÐ½Ñ‹ Ð´Ð»Ñ Ð²Ñ‹ÑÑ‚ÑƒÐ¿Ð»ÐµÐ½Ð¸Ð¹<br />
                        ðŸ”— ÐŸÑ€Ð¸Ð³Ð»Ð°ÑˆÐµÐ½Ð¸Ñ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€Ñ‹<br />
                        ðŸ‘¥ ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ ÑƒÑ‡Ð°ÑÑ‚Ð½Ð¸ÐºÐ¾Ð² Ð² Ñ€ÐµÐ°Ð»ÑŒÐ½Ð¾Ð¼ Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸<br />
                        ðŸ”” Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ð¹<br />
                        <span className="text-green-400">â˜ï¸ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ°Ñ ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð¸Ð·Ð°Ñ†Ð¸Ñ Ñ‡ÐµÑ€ÐµÐ· GitHub</span>
                      </p>
                      <div className="flex items-center justify-center space-x-4">
                        <div className="text-center">
                          <div className="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-2">
                            <Plus className="text-green-500" />
                          </div>
                          <p className="text-sm text-gray-400">Ð¡Ð¾Ð·Ð´Ð°Ñ‚ÑŒ ÑÐµÑ€Ð²ÐµÑ€</p>
                        </div>
                        <div className="text-center">
                          <div className="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-2">
                            <UserPlus className="text-indigo-500" />
                          </div>
                          <p className="text-sm text-gray-400">Ð”Ð¾Ð±Ð°Ð²Ð¸Ñ‚ÑŒ Ð´Ñ€ÑƒÐ·ÐµÐ¹</p>
                        </div>
                        <div className="text-center">
                          <div className="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-2">
                            <Mail className="text-purple-500" />
                          </div>
                          <p className="text-sm text-gray-400">Ð›Ð¸Ñ‡Ð½Ñ‹Ðµ ÑÐ¾Ð¾Ð±Ñ‰ÐµÐ½Ð¸Ñ</p>
                        </div>
                        <div className="text-center">
                          <div className="w-12 h-12 bg-gray-800 rounded-full flex items-center justify-center mx-auto mb-2">
                            <User className="text-blue-500" />
                          </div>
                          <p className="text-sm text-gray-400">ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð¿Ñ€Ð¾Ñ„Ð¸Ð»Ñ</p>
                        </div>
                      </div>
                      
                      {/* ÐšÐ½Ð¾Ð¿ÐºÐ° Premium Ð½Ð° Ð³Ð»Ð°Ð²Ð½Ð¾Ð¹ ÑÑ‚Ñ€Ð°Ð½Ð¸Ñ†Ðµ */}
                      {!hasPremium && (
                        <div className="mt-8">
                          <button 
                            onClick={() => setShowPremiumModal(true)}
                            className="premium-badge px-6 py-3 rounded-lg text-black font-bold flex items-center space-x-2 mx-auto transform hover:scale-105 transition"
                          >
                            <Crown className="w-5 h-5" />
                            <span>ÐŸÐ¾Ð»ÑƒÑ‡Ð¸Ñ‚ÑŒ Premium ÑÐ¾ ÑÐºÐ¸Ð´ÐºÐ¾Ð¹</span>
                          </button>
                        </div>
                      )}
                    </div>
                  </div>
                )}
              </div>
            </div>
          );
        };

        ReactDOM.render(<ChatApp />, document.getElementById('root'));
    </script>
</body>
</html>
